(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["view-cluster"],{"07ac":function(t,e,r){var i=r("23e7"),n=r("6f53").values;i({target:"Object",stat:!0},{values:function(t){return n(t)}})},"27f4":function(t,e,r){},3024:function(t,e,r){},3187:function(t,e,r){},3854:function(t,e,r){},"481a":function(t,e,r){"use strict";r("f1f1")},"53a7":function(t,e,r){},"5cad":function(t,e,r){},"5cbb9":function(t,e,r){"use strict";r("3024")},"5e58":function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.EOL="\r\n",t.BOM="\ufeff",t.DEFAULT_FIELD_SEPARATOR=",",t.DEFAULT_DECIMAL_SEPARATOR=".",t.DEFAULT_QUOTE='"',t.DEFAULT_SHOW_TITLE=!1,t.DEFAULT_TITLE="My Generated Report",t.DEFAULT_FILENAME="generated",t.DEFAULT_SHOW_LABELS=!1,t.DEFAULT_USE_TEXT_FILE=!1,t.DEFAULT_USE_BOM=!0,t.DEFAULT_HEADER=[],t.DEFAULT_KEYS_AS_HEADERS=!1,t}();e.CsvConfigConsts=i,e.ConfigDefaults={filename:i.DEFAULT_FILENAME,fieldSeparator:i.DEFAULT_FIELD_SEPARATOR,quoteStrings:i.DEFAULT_QUOTE,decimalSeparator:i.DEFAULT_DECIMAL_SEPARATOR,showLabels:i.DEFAULT_SHOW_LABELS,showTitle:i.DEFAULT_SHOW_TITLE,title:i.DEFAULT_TITLE,useTextFile:i.DEFAULT_USE_TEXT_FILE,useBom:i.DEFAULT_USE_BOM,headers:i.DEFAULT_HEADER,useKeysAsHeaders:i.DEFAULT_KEYS_AS_HEADERS};var n=function(){function t(t){this._csv="";var r=t||{};this._options=c({},e.ConfigDefaults,r),this._options.useKeysAsHeaders&&this._options.headers&&this._options.headers.length>0&&console.warn("Option to use object keys as headers was set, but headers were still passed!")}return Object.defineProperty(t.prototype,"options",{get:function(){return this._options},set:function(t){this._options=c({},e.ConfigDefaults,t)},enumerable:!0,configurable:!0}),t.prototype.generateCsv=function(t,e){if(void 0===e&&(e=!1),this._csv="",this._parseData(t),this._options.useBom&&(this._csv+=i.BOM),this._options.showTitle&&(this._csv+=this._options.title+"\r\n\n"),this._getHeaders(),this._getBody(),""!=this._csv){if(e)return this._csv;var r=this._options.useTextFile?"plain":"csv",n=this._options.useTextFile?".txt":".csv",a=new Blob([this._csv],{type:"text/"+r+";charset=utf8;"});if(navigator.msSaveBlob){var s=this._options.filename.replace(/ /g,"_")+n;navigator.msSaveBlob(a,s)}else{var o=this._options.useTextFile?"text":"csv",c=(encodeURI(this._csv),document.createElement("a"));c.href=URL.createObjectURL(a),c.setAttribute("visibility","hidden"),c.download=this._options.filename.replace(/ /g,"_")+n,document.body.appendChild(c),c.click(),document.body.removeChild(c)}}else console.log("Invalid data")},t.prototype._getHeaders=function(){if(this._options.showLabels||this._options.useKeysAsHeaders){var t=this._options.useKeysAsHeaders,e=t?Object.keys(this._data[0]):this._options.headers;if(e.length>0){for(var r="",n=0;n<e.length;n++)r+=e[n]+this._options.fieldSeparator;r=r.slice(0,-1),this._csv+=r+i.EOL}}},t.prototype._getBody=function(){for(var t=Object.keys(this._data[0]),e=0;e<this._data.length;e++){for(var r="",n=0;n<t.length;n++){var a=t[n];r+=this._formatData(this._data[e][a])+this._options.fieldSeparator}r=r.slice(0,-1),this._csv+=r+i.EOL}},t.prototype._formatData=function(t){return"locale"===this._options.decimalSeparator&&this._isFloat(t)?t.toLocaleString():"."!==this._options.decimalSeparator&&this._isFloat(t)?t.toString().replace(".",this._options.decimalSeparator):"string"===typeof t?(t=t.replace(/"/g,'""'),(this._options.quoteStrings||t.indexOf(",")>-1||t.indexOf("\n")>-1||t.indexOf("\r")>-1)&&(t=this._options.quoteStrings+t+this._options.quoteStrings),t):"boolean"===typeof t?t?"TRUE":"FALSE":t},t.prototype._isFloat=function(t){return+t===t&&(!isFinite(t)||Boolean(t%1))},t.prototype._parseData=function(t){return this._data="object"!=typeof t?JSON.parse(t):t,this._data},t}();e.ExportToCsv=n;var a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function o(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function c(t){for(var e,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];for(var n,c=o(t),l=1;l<arguments.length;l++){for(var u in e=Object(arguments[l]),e)a.call(e,u)&&(c[u]=e[u]);if(Object.getOwnPropertySymbols){n=Object.getOwnPropertySymbols(e);for(var d=0;d<n.length;d++)s.call(e,n[d])&&(c[n[d]]=e[n[d]])}}return c}},"6f53":function(t,e,r){var i=r("83ab"),n=r("df75"),a=r("fc6a"),s=r("d1e7").f,o=function(t){return function(e){var r,o=a(e),c=n(o),l=c.length,u=0,d=[];while(l>u)r=c[u++],i&&!s.call(o,r)||d.push(t?[r,o[r]]:o[r]);return d}};t.exports={entries:o(!0),values:o(!1)}},"7e12":function(t,e,r){var i=r("da84"),n=r("58a8").trim,a=r("5899"),s=i.parseFloat,o=1/s(a+"-0")!==-1/0;t.exports=o?function(t){var e=n(String(t)),r=s(e);return 0===r&&"-"==e.charAt(0)?-0:r}:s},"93d2":function(t,e,r){"use strict";r("e39e")},"95c0":function(t,e,r){},"9e28":function(t,e,r){"use strict";r("27f4")},b1c1:function(t,e,r){"use strict";r("7db0");var i=r("2ef0");e["a"]={data:function(){return{unitOptions:[{type:"length",unit:"meter",display:"m"},{type:"area",unit:"meter ** 2",display:"m²"},{type:"volume",unit:"meter ** 3",display:"m³"},{type:"time",unit:"second",display:"s"},{type:"angle",unit:"rad",display:"radians"},{type:"mass",unit:"kilogram",display:"kg"},{type:"temperature",unit:"kelvin",display:"K"},{type:"frequency",unit:"1 / second",display:"s<sup>-1</sup>"},{type:"velocity",unit:"meter / second",display:"m/s"},{type:"acceleration",unit:"meter / second ** 2",display:"m/s²"},{type:"force",unit:"kilogram * meter / second ** 2",display:"N"},{type:"energy",unit:"kilogram * meter ** 2 / second ** 2",display:"J"},{type:"power",unit:"kilogram * meter ** 2 / second ** 3",display:"W"},{type:"momentum",unit:"meter * kilogram / second",display:"kg m s<sup>-1</sup>"},{type:"density",unit:"kilogram / meter ** 3",display:"kg/m³"},{type:"pressure",unit:"kilogram / meter ** 2",display:"Pa"},{type:"electric potential",unit:"kilogram * meter ** 2 / ampere / second ** 3",display:"V"},{type:"current",unit:"ampere",display:"A"},{type:"count",unit:"dimensionless",display:""},{type:"count",unit:"count",display:""},{type:"count",unit:"percentage",display:"%"},{type:"sound intensity",unit:"decibel",display:"dB"}]}},methods:{formatUnit:function(t){var e=i.find(this.unitOptions,{unit:t});return e?e.display:t}}}},b3a7:function(t,e,r){},b79e:function(t,e,r){"use strict";r("b3a7")},bb5b:function(t,e,r){"use strict";r("53a7")},bcee:function(t,e,r){"use strict";r("95c0")},c35a:function(t,e,r){var i=r("23e7"),n=r("7e12");i({target:"Number",stat:!0,forced:Number.parseFloat!=n},{parseFloat:n})},d531:function(t,e,r){!function(e,i){t.exports=i(r("c1df"))}(0,(function(t){return function(t){function e(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var r={};return e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=3)}([function(t,e,r){"use strict";var i=r(5)();t.exports=function(t){return t!==i&&null!==t}},function(t,e,r){"use strict";t.exports=r(18)()?Symbol:r(20)},function(e,r){e.exports=t},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t){return t.range=function(e,r){var i=this;return"string"==typeof e&&g.hasOwnProperty(e)?new m(t(i).startOf(e),t(i).endOf(e)):new m(e,r)},t.rangeFromInterval=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t();if(t.isMoment(i)||(i=t(i)),!i.isValid())throw new Error("Invalid date.");var n=i.clone().add(r,e),a=[];return a.push(t.min(i,n)),a.push(t.max(i,n)),new m(a)},t.rangeFromISOString=function(e){var r=o(e),i=t.parseZone(r[0]),n=t.parseZone(r[1]);return new m(i,n)},t.parseZoneRange=t.rangeFromISOString,t.fn.range=t.range,t.range.constructor=m,t.isRange=function(t){return t instanceof m},t.fn.within=function(t){return t.contains(this.toDate())},t}function o(t){return t.split("/")}Object.defineProperty(e,"__esModule",{value:!0}),e.DateRange=void 0;var c=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}();e.extendMoment=s;var d=r(2),p=i(d),h=r(1),f=i(h),g={year:!0,quarter:!0,month:!0,week:!0,day:!0,hour:!0,minute:!0,second:!0},m=e.DateRange=function(){function t(e,r){a(this,t);var i=e,n=r;if(1===arguments.length||void 0===r)if("object"===(void 0===e?"undefined":l(e))&&2===e.length){var s=c(e,2);i=s[0],n=s[1]}else if("string"==typeof e){var u=o(e),d=c(u,2);i=d[0],n=d[1]}this.start=i||0===i?(0,p.default)(i):(0,p.default)(-864e13),this.end=n||0===n?(0,p.default)(n):(0,p.default)(864e13)}return u(t,[{key:"adjacent",value:function(t){var e=this.start.isSame(t.end),r=this.end.isSame(t.start);return e&&t.start.valueOf()<=this.start.valueOf()||r&&t.end.valueOf()>=this.end.valueOf()}},{key:"add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{adjacent:!1};return this.overlaps(t,e)?new this.constructor(p.default.min(this.start,t.start),p.default.max(this.end,t.end)):null}},{key:"by",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{excludeEnd:!1,step:1},r=this;return n({},f.default.iterator,(function(){var i=e.step||1,n=Math.abs(r.start.diff(r.end,t))/i,a=e.excludeEnd||!1,s=0;return e.hasOwnProperty("exclusive")&&(a=e.exclusive),{next:function(){var e=r.start.clone().add(s*i,t),o=a?!(s<n):!(s<=n);return s++,{done:o,value:o?void 0:e}}}}))}},{key:"byRange",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{excludeEnd:!1,step:1},r=this,i=e.step||1,a=this.valueOf()/t.valueOf()/i,s=Math.floor(a),o=e.excludeEnd||!1,c=0;return e.hasOwnProperty("exclusive")&&(o=e.exclusive),n({},f.default.iterator,(function(){return s===1/0?{done:!0}:{next:function(){var e=(0,p.default)(r.start.valueOf()+t.valueOf()*c*i),n=s===a&&o?!(c<s):!(c<=s);return c++,{done:n,value:n?void 0:e}}}}))}},{key:"center",value:function(){var t=this.start.valueOf()+this.diff()/2;return(0,p.default)(t)}},{key:"clone",value:function(){return new this.constructor(this.start.clone(),this.end.clone())}},{key:"contains",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{excludeStart:!1,excludeEnd:!1},i=this.start.valueOf(),n=this.end.valueOf(),a=e.valueOf(),s=e.valueOf(),o=r.excludeStart||!1,c=r.excludeEnd||!1;r.hasOwnProperty("exclusive")&&(o=c=r.exclusive),e instanceof t&&(a=e.start.valueOf(),s=e.end.valueOf());var l=i<a||i<=a&&!o,u=n>s||n>=s&&!c;return l&&u}},{key:"diff",value:function(t,e){return this.end.diff(this.start,t,e)}},{key:"duration",value:function(t,e){return this.diff(t,e)}},{key:"intersect",value:function(t){var e=this.start.valueOf(),r=this.end.valueOf(),i=t.start.valueOf(),n=t.end.valueOf(),a=e==r,s=i==n;if(a){var o=e;if(o==i||o==n)return null;if(o>i&&o<n)return this.clone()}else if(s){var c=i;if(c==e||c==r)return null;if(c>e&&c<r)return new this.constructor(c,c)}return e<=i&&i<r&&r<n?new this.constructor(i,r):i<e&&e<n&&n<=r?new this.constructor(e,n):i<e&&e<=r&&r<n?this.clone():e<=i&&i<=n&&n<=r?new this.constructor(i,n):null}},{key:"isEqual",value:function(t){return this.start.isSame(t.start)&&this.end.isSame(t.end)}},{key:"isSame",value:function(t){return this.isEqual(t)}},{key:"overlaps",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{adjacent:!1},r=null!==this.intersect(t);return e.adjacent&&!r?this.adjacent(t):r}},{key:"reverseBy",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{excludeStart:!1,step:1},r=this;return n({},f.default.iterator,(function(){var i=e.step||1,n=Math.abs(r.start.diff(r.end,t))/i,a=e.excludeStart||!1,s=0;return e.hasOwnProperty("exclusive")&&(a=e.exclusive),{next:function(){var e=r.end.clone().subtract(s*i,t),o=a?!(s<n):!(s<=n);return s++,{done:o,value:o?void 0:e}}}}))}},{key:"reverseByRange",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{excludeStart:!1,step:1},r=this,i=e.step||1,a=this.valueOf()/t.valueOf()/i,s=Math.floor(a),o=e.excludeStart||!1,c=0;return e.hasOwnProperty("exclusive")&&(o=e.exclusive),n({},f.default.iterator,(function(){return s===1/0?{done:!0}:{next:function(){var e=(0,p.default)(r.end.valueOf()-t.valueOf()*c*i),n=s===a&&o?!(c<s):!(c<=s);return c++,{done:n,value:n?void 0:e}}}}))}},{key:"snapTo",value:function(t){var e=this.clone();return e.start.isSame((0,p.default)(-864e13))||(e.start=e.start.startOf(t)),e.end.isSame((0,p.default)(864e13))||(e.end=e.end.endOf(t)),e}},{key:"subtract",value:function(t){var e=this.start.valueOf(),r=this.end.valueOf(),i=t.start.valueOf(),n=t.end.valueOf();return null===this.intersect(t)?[this]:i<=e&&e<r&&r<=n?[]:i<=e&&e<n&&n<r?[new this.constructor(n,r)]:e<i&&i<r&&r<=n?[new this.constructor(e,i)]:e<i&&i<n&&n<r?[new this.constructor(e,i),new this.constructor(n,r)]:e<i&&i<r&&n<r?[new this.constructor(e,i),new this.constructor(i,r)]:[]}},{key:"toDate",value:function(){return[this.start.toDate(),this.end.toDate()]}},{key:"toString",value:function(){return this.start.format()+"/"+this.end.format()}},{key:"valueOf",value:function(){return this.end.valueOf()-this.start.valueOf()}}]),t}()},function(t,e,r){"use strict";var i,n=r(6),a=r(13),s=r(9),o=r(15);i=t.exports=function(t,e){var r,i,s,c,l;return arguments.length<2||"string"!=typeof t?(c=e,e=t,t=null):c=arguments[2],null==t?(r=s=!0,i=!1):(r=o.call(t,"c"),i=o.call(t,"e"),s=o.call(t,"w")),l={value:e,configurable:r,enumerable:i,writable:s},c?n(a(c),l):l},i.gs=function(t,e,r){var i,c,l,u;return"string"!=typeof t?(l=r,r=e,e=t,t=null):l=arguments[3],null==e?e=void 0:s(e)?null==r?r=void 0:s(r)||(l=r,r=void 0):(l=e,e=r=void 0),null==t?(i=!0,c=!1):(i=o.call(t,"c"),c=o.call(t,"e")),u={get:e,set:r,configurable:i,enumerable:c},l?n(a(l),u):u}},function(t,e,r){"use strict";t.exports=function(){}},function(t,e,r){"use strict";t.exports=r(7)()?Object.assign:r(8)},function(t,e,r){"use strict";t.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(t={foo:"raz"},e(t,{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},function(t,e,r){"use strict";var i=r(10),n=r(14),a=Math.max;t.exports=function(t,e){var r,s,o,c=a(arguments.length,2);for(t=Object(n(t)),o=function(i){try{t[i]=e[i]}catch(t){r||(r=t)}},s=1;s<c;++s)e=arguments[s],i(e).forEach(o);if(void 0!==r)throw r;return t}},function(t,e,r){"use strict";t.exports=function(t){return"function"==typeof t}},function(t,e,r){"use strict";t.exports=r(11)()?Object.keys:r(12)},function(t,e,r){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},function(t,e,r){"use strict";var i=r(0),n=Object.keys;t.exports=function(t){return n(i(t)?Object(t):t)}},function(t,e,r){"use strict";var i=r(0),n=Array.prototype.forEach,a=Object.create,s=function(t,e){var r;for(r in t)e[r]=t[r]};t.exports=function(t){var e=a(null);return n.call(arguments,(function(t){i(t)&&s(Object(t),e)})),e}},function(t,e,r){"use strict";var i=r(0);t.exports=function(t){if(!i(t))throw new TypeError("Cannot use null or undefined");return t}},function(t,e,r){"use strict";t.exports=r(16)()?String.prototype.contains:r(17)},function(t,e,r){"use strict";var i="razdwatrzy";t.exports=function(){return"function"==typeof i.contains&&!0===i.contains("dwa")&&!1===i.contains("foo")}},function(t,e,r){"use strict";var i=String.prototype.indexOf;t.exports=function(t){return i.call(this,t,arguments[1])>-1}},function(t,e,r){"use strict";var i={object:!0,symbol:!0};t.exports=function(){var t;if("function"!=typeof Symbol)return!1;t=Symbol("test symbol");try{String(t)}catch(t){return!1}return!!i[typeof Symbol.iterator]&&!!i[typeof Symbol.toPrimitive]&&!!i[typeof Symbol.toStringTag]}},function(t,e,r){"use strict";t.exports=function(t){return!!t&&("symbol"==typeof t||!!t.constructor&&"Symbol"===t.constructor.name&&"Symbol"===t[t.constructor.toStringTag])}},function(t,e,r){"use strict";var i,n,a,s,o=r(4),c=r(21),l=Object.create,u=Object.defineProperties,d=Object.defineProperty,p=Object.prototype,h=l(null);if("function"==typeof Symbol){i=Symbol;try{String(i()),s=!0}catch(t){}}var f=function(){var t=l(null);return function(e){for(var r,i,n=0;t[e+(n||"")];)++n;return e+=n||"",t[e]=!0,r="@@"+e,d(p,r,o.gs(null,(function(t){i||(i=!0,d(this,r,o(t)),i=!1)}))),r}}();a=function(t){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return n(t)},t.exports=n=function t(e){var r;if(this instanceof t)throw new TypeError("Symbol is not a constructor");return s?i(e):(r=l(a.prototype),e=void 0===e?"":String(e),u(r,{__description__:o("",e),__name__:o("",f(e))}))},u(n,{for:o((function(t){return h[t]?h[t]:h[t]=n(String(t))})),keyFor:o((function(t){var e;for(e in c(t),h)if(h[e]===t)return e})),hasInstance:o("",i&&i.hasInstance||n("hasInstance")),isConcatSpreadable:o("",i&&i.isConcatSpreadable||n("isConcatSpreadable")),iterator:o("",i&&i.iterator||n("iterator")),match:o("",i&&i.match||n("match")),replace:o("",i&&i.replace||n("replace")),search:o("",i&&i.search||n("search")),species:o("",i&&i.species||n("species")),split:o("",i&&i.split||n("split")),toPrimitive:o("",i&&i.toPrimitive||n("toPrimitive")),toStringTag:o("",i&&i.toStringTag||n("toStringTag")),unscopables:o("",i&&i.unscopables||n("unscopables"))}),u(a.prototype,{constructor:o(n),toString:o("",(function(){return this.__name__}))}),u(n.prototype,{toString:o((function(){return"Symbol ("+c(this).__description__+")"})),valueOf:o((function(){return c(this)}))}),d(n.prototype,n.toPrimitive,o("",(function(){var t=c(this);return"symbol"==typeof t?t:t.toString()}))),d(n.prototype,n.toStringTag,o("c","Symbol")),d(a.prototype,n.toStringTag,o("c",n.prototype[n.toStringTag])),d(a.prototype,n.toPrimitive,o("c",n.prototype[n.toPrimitive]))},function(t,e,r){"use strict";var i=r(19);t.exports=function(t){if(!i(t))throw new TypeError(t+" is not a symbol");return t}}])}))},e231:function(t,e,r){"use strict";r("5cad")},e39e:function(t,e,r){},e3fc:function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"cluster-show"},[r("loading-screen",{attrs:{"is-loading":t.isLoading||t.isLoadingInsights||t.isLoadingOrdersWithMatches||t.isDeleting}}),r("a-layout",[r("a-layout",{staticStyle:{padding:"7px 30px"}},[r("div",{staticClass:"wrapper"},[t.cluster?r("a-page-header",{attrs:{title:t.cluster.name},on:{back:t.backToAllClusters}},[r("template",{slot:"extra"},[r("a-button",{attrs:{icon:"download"},on:{click:function(e){return e.preventDefault(),t.exportCsv(e)}}}),r("cluster-filters"),r("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(e){return e.preventDefault(),function(){return t.toggleSidebar()}()}}},[t._v("Add Order ")])],1)],2):t._e(),t.cluster&&!t.isLoadingOrdersWithMatches?r("div",[r("div",{staticClass:"cluster-graphs-wrapper"},[r("cluster-graphs",{key:t.reloadKey,attrs:{"graph-reload-key":t.graphReloadKey,"cluster-id":t.cluster["_id"]}})],1),"product-details"!==t.activeGraph?r("a-tabs",[r("a-tab-pane",{attrs:{tab:"All Orders"}},[r("cluster-orders-table",{key:t.reloadKey,attrs:{"cluster-id":t.cluster["_id"]},on:{"record-selected":function(e){return t.viewInsightsFor(e)},"remove-order":t.removeOrder}})],1)],1):t._e()],1):t._e()],1)]),r("a-layout-sider",{style:{background:"#f7fafc",borderLeft:"1px solid #e3e8ee"},attrs:{width:(t.sidebarType,500),theme:"dark","collapsed-width":0,trigger:null,collapsible:""},model:{value:t.shouldHideSidebar,callback:function(e){t.shouldHideSidebar=e},expression:"shouldHideSidebar"}},[t.shouldShowSidebar&&"add-order"===t.sidebarType?r("sidebar",{attrs:{"cluster-id":t.cluster["_id"]},on:{close:function(){return t.toggleSidebar()},reload:t.incrementReloadKey}}):t._e(),t.shouldShowSidebar&&"insights"===t.sidebarType?r("insights-sidebar",{attrs:{"cluster-id":t.cluster["_id"],"insights-applied":t.insightsApplied,"erp-order-id":t.selectedErpOrderId,insights:t.insights},on:{close:function(){return t.toggleSidebar("insights")},reload:t.incrementReloadKey,"insights-saved":t.incrementReloadKey}}):t._e()],1)],1)],1)},n=[],a=(r("d81d"),r("b0c0"),r("a9e3"),r("53ca")),s=r("5530"),o=r("bc3a"),c=r.n(o),l=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("a-table",{staticClass:"axpi-table",attrs:{scroll:{x:1300},columns:t.columns,"row-key":function(t){return t.id},"data-source":t.dataToShow,loading:t.loading},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"name",fn:function(e,i){return r("div",{},[r("div",{staticClass:"product-name-wrapper"},[r("div",{staticClass:"left"},[r("a",{attrs:{target:"_blank",href:t.getFirstProduct(i)?t.getFirstProduct(i)["URL"]:"#"}},[r("a-avatar",{staticStyle:{"margin-right":"20px"},attrs:{size:"large",src:t.getImageSrc(t.getFirstProduct(i))}})],1)]),r("div",{staticClass:"right"},[t.getFirstProduct(i)?r("a",{attrs:{target:"_blank",href:t.getProductLink(t.getFirstProduct(i))}},[t._v(" "+t._s(e)+" ")]):r("span",[t._v(t._s(i["PO Li Description"]))])])])])}},{key:"datePurchased",fn:function(e){return r("div",{},[t._v(" "+t._s(t.formatDatePurchased(e))+" ")])}},{key:"quantity",fn:function(e,i){return r("div",{},[t._v(" "+t._s(t.getQuantity(i))+" ")])}},{key:"cost",fn:function(e){return r("div",{},[t._v(" "+t._s(t.formatCost({cost:e,cost_currency:"USD"}))+" ")])}},{key:"potentialSavings",fn:function(e,i){return r("div",{},[t.calculateMaxPotentialSavings(i)?r("span",[t.calculateMinPotentialSavings(i)!==t.calculateMaxPotentialSavings(i)&&0!==Math.round(t.calculateMinPotentialSavings(i))?r("span",[t._v(" "+t._s(t.formatCost({cost:t.calculateMinPotentialSavings(i),cost_currency:"USD"}))+" - ")]):t._e(),t._v(" "+t._s(t.formatCost({cost:t.calculateMaxPotentialSavings(i),cost_currency:"USD"}))+" ")]):r("span")])}},{key:"normalisedMeasure",fn:function(e,i){return r("div",{},[r("span",{domProps:{innerHTML:t._s(t.getNormalisedMeasure(i))}})])}},{key:"productUnitOfMeasure",fn:function(e,i){return r("div",{},[r("span",{domProps:{innerHTML:t._s(t.getFirstProductUnitOfMeasure(i))}})])}},{key:"insights",fn:function(e,i){return r("div",{staticClass:"insights-column"},[r("a",{staticStyle:{"margin-right":"15px"},attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.handleRecordSelected(i)}}},[r("a-icon",{staticStyle:{"margin-right":"4px"},attrs:{type:"eye"}}),t._v(" View ")],1),r("a-dropdown",{attrs:{trigger:["click"]}},[r("a-button",{attrs:{type:"link",icon:"ellipsis"},on:{click:function(t){return t.preventDefault(),function(t){return t.preventDefault()}(t)}}}),r("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[r("a-menu-item",[r("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.editMatch(i)}}},[t._v("Edit Match")])]),r("a-menu-item",[r("a",{staticClass:"text-danger",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.deleteRecord(i)}}},[t._v("Remove")])])],1)],1)],1)}}])})},u=[],d=(r("4de4"),r("caad"),r("c35a"),r("ac1f"),r("2532"),r("1276"),r("2d20")),p=r("b1c1"),h=r("2f62"),f=r("c1df"),g=r.n(f),m=r("d531"),y=Object(m["extendMoment"])(g.a),v=r("2ef0"),_={props:["clusterId"],mixins:[d["a"],p["a"]],data:function(){return{data:[],loading:!1}},methods:Object(s["a"])(Object(s["a"])({},Object(h["b"])("clusterViewer",{setSortField:"setSortField",setSortOrder:"setSortOrder",setFilters:"setFilters"})),{},{editMatch:function(t){window.open("/matcher?erpOrderId="+t["_id"])},deleteRecord:function(t){this.$emit("remove-order",t)},handleRecordSelected:function(t){this.$emit("record-selected",t)},getFirstProduct:function(t){return t["products"][0]},getImageSrc:function(t){if(t["imageURLs"]&&t["imageURLs"].length)return t["imageURLs"][0]},getQuantity:function(t){return t["total_quantity"]?t["total_quantity"]:Number(t["Quantity"])},calculateMinPotentialSavings:function(t){var e=v.filter(this.insights,(function(e){return e["erp_order_id"]==t["_id"]})),r=0,i=v.groupBy(e,"insight_type");return v.each(i,(function(t){var e=v.min(v.map(t,"potential_savings"));r+=e})),r},calculateMaxPotentialSavings:function(t){var e=v.filter(this.insights,(function(e){return e["erp_order_id"]==t["_id"]})),r=0,i=v.groupBy(e,"insight_type");return v.each(i,(function(t){var e=v.max(v.map(t,"potential_savings"));r+=e})),r},formatDatePurchased:function(t){if(t["$date"]&&t["$date"]["$numberLong"]){var e=t["$date"]["$numberLong"]/1e3;return y.unix(e).format("DD/MM/YYYY")}return"-"},getNormalisedMeasureMagnitude:function(t){var e="None"!==t["Quantity"]?Number(t["Quantity"]):1,r=this.getFirstProduct(t),i=null;if(r&&r["normalisedMeasure"]){var n=r["normalisedMeasure"]["normalisedUnitMagnitude"];n&&(i=n*e)}return i},getFirstProductUnitOfMeasure:function(t){var e=this.getFirstProduct(t);return e&&e["normalisedQuantity"]?e["normalisedQuantity"]["unit"]:null},getNormalisedMeasure:function(t){var e="None"!==t["Quantity"]?Number(t["Quantity"]):1,r=this.getFirstProduct(t),i=null;if(r&&r["normalisedMeasure"]&&r["normalisedMeasure"]){var n=r["normalisedMeasure"]["normalisedUnitMagnitude"]*e,a=r["normalisedMeasure"]["normalisedUnitBase"];if(n&&a){if(n<1){var s=Number.parseFloat(n).toExponential(3),o=s.split("e");n=o[0]+" x 10<sup>"+o[1]+"</sup>"}i=String(n)+" "+this.formatUnit(a)}}return i||""},getProductLink:function(t){return"/products/"+t["_id"]},handleTableChange:function(t,e,r){this.setSortField(r.field),this.setSortOrder(r.order),this.setFilters(e)}}),computed:Object(s["a"])(Object(s["a"])({},Object(h["c"])("clusterViewer",{selectedOrders:"selectedOrders",ordersWithMatches:"ordersWithMatches",ordersWithMatchesFiltered:"ordersWithMatchesFiltered",insights:"insights",sortField:"sortField",sortOrder:"sortOrder",filters:"filters",startDate:"startDate",endDate:"endDate"})),{},{columns:function(){return[{title:"Name",dataIndex:"product_name",scopedSlots:{customRender:"name"},fixed:"left",width:350,sorter:!0,filters:v.map(this.productNameOptions,(function(t){return{text:t,value:t}}))},{title:"Date Purchased",dataIndex:"PO Initial Create Date",scopedSlots:{customRender:"datePurchased"},sorter:!0,width:160},{title:"Quantity",dataIndex:"total_quantity",sorter:!0,width:110},{title:"Cost",dataIndex:"CHF_FLOAT",scopedSlots:{customRender:"cost"},sorter:!0,width:110},{title:"Potential Savings",dataIndex:"Potential Savings",scopedSlots:{customRender:"potentialSavings"},sorter:!0,width:150},{title:"Measure",dataIndex:"Measure",scopedSlots:{customRender:"normalisedMeasure"},sorter:!0,width:170},{title:"PO Number",dataIndex:"PO Number",width:130,sorter:!0},{title:"PO Name",dataIndex:"PO Li Description",sorter:!0,width:300},{title:"Product Code",dataIndex:"product_code",sorter:!0,width:150},{title:"Vendor",dataIndex:"Vendor",width:200,filters:v.map(this.vendorFilterOptions,(function(t){return{text:t,value:t}}))},{title:"BU of Measure",dataIndex:"BU of Measure",width:150},{title:"Product Unit of Measure",dataIndex:"Product Unit of Measure",scopedSlots:{customRender:"productUnitOfMeasure"},width:200},{title:"Insights",scopedSlots:{customRender:"insights"},fixed:"right",width:140}]},vendorFilterOptions:function(){return v.uniq(v.map(this.ordersWithMatches,"Vendor"))},productNameOptions:function(){return v.uniq(v.map(this.ordersWithMatches,"product_name"))},dataToShow:function(){var t=this,e=[];if(this.selectedOrders.length){var r=v.map(this.selectedOrders,"_id");e=v.filter(this.ordersWithMatchesFiltered,(function(t){return r.includes(t["_id"])}))}else e=this.ordersWithMatchesFiltered;e=v.filter(e,(function(e){var r=null,i=null;return e["PO Initial Create Date"]&&e["PO Initial Create Date"]["$date"]&&e["PO Initial Create Date"]["$date"]["$numberLong"]&&(i=y.unix(Number(e["PO Initial Create Date"]["$date"]["$numberLong"])/1e3),r=i.format("DD/MM/YYYY")),e.order_date=r,e.order_date_moment=i,!(e.order_date_moment&&y(e.order_date_moment).isValid()&&t.startDate&&e.order_date_moment.isBefore(t.startDate))&&!(e.order_date_moment&&y(e.order_date_moment).isValid()&&t.endDate&&e.order_date_moment.isAfter(t.endDate))}));var i="ascend"===this.sortOrder?"asc":"desc";switch(this.sortField){case"product_name":e=v.orderBy(e,"product_name",i);break;case"Potential Savings":e=v.map(e,(function(e){return e.maxSaving=t.calculateMaxPotentialSavings(e),e})),e=v.orderBy(e,"maxSaving",i);break;case"Measure":e=v.map(e,(function(e){return e.measureMagnitude=t.getNormalisedMeasureMagnitude(e),e})),e=v.orderBy(e,"measureMagnitude",i);break;case"PO Initial Create Date":e=v.map(e,(function(t){return t["PO Initial Create Date"]&&t["PO Initial Create Date"]["$date"]&&t["PO Initial Create Date"]["$date"]["$numberLong"]?t.timestamp=t["PO Initial Create Date"]["$date"]["$numberLong"]:t.timestamp=null,t})),e=v.orderBy(e,"timestamp",i);break;case"total_quantity":e=v.orderBy(e,"total_quantity",i);break;case"Cost":e=v.orderBy(e,"Cost",i);break;case"CHF_FLOAT":e=v.orderBy(e,"CHF_FLOAT",i);break;case"PO Number":e=v.orderBy(e,"PO Number",i);break;case"PO Li Description":e=v.orderBy(e,"PO Li Description",i);break;case"product_code":e=v.orderBy(e,"product_code",i);break;default:break}return e}})},b=_,O=(r("bcee"),r("2877")),S=Object(O["a"])(b,l,u,!1,null,"1dc89480",null),D=S.exports,w=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"cluster-graphs"},[r("a-tabs",{model:{value:t.active_graph,callback:function(e){t.active_graph=e},expression:"active_graph"}},[r("a-tab-pane",{key:"orders",attrs:{tab:"Orders"}}),r("a-tab-pane",{key:"demand",attrs:{tab:"Demand"}}),r("a-tab-pane",{key:"product-details",attrs:{tab:"Product Details"}})],1),"product-details"!==t.activeGraph?r("a-card",[r("a-row",{attrs:{type:"flex",gutter:20}},[r("a-col",{attrs:{span:19}},[t.isLoading?r("div",{staticStyle:{"text-align":"center"}},[r("a-spin")],1):r("div",["orders"===t.activeGraph?r("cluster-orders-graph",{attrs:{"graph-reload-key":t.graphReloadKey,orders:t.ordersWithMatchesFiltered}}):t._e(),"demand"===t.activeGraph?r("cluster-demand-graph",{attrs:{"graph-reload-key":t.graphReloadKey,orders:t.ordersWithMatchesFiltered}}):t._e()],1)]),r("a-col",{attrs:{span:5}},[r("div",{staticClass:"sidebar-wrapper"},[r("cluster-stats-sidebar",{attrs:{"cluster-id":t.clusterId}})],1)])],1)],1):t._e(),"product-details"===t.activeGraph?r("div",[t.isLoading?r("div",{staticStyle:{"text-align":"center"}},[r("a-spin")],1):t._e(),"product-details"===t.activeGraph?r("all-product-details-table"):t._e()],1):t._e()],1)},x=[],L=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"wrapper"},[t.isLoading?r("div",{staticStyle:{"text-align":"center"}},[r("a-spin")],1):t._e(),t._l(t.statsToShow,(function(e,i){return r("div",{key:i,staticClass:"stat"},[t.isLoading?t._e():r("a-statistic",{staticStyle:{"text-align":"right"},attrs:{title:e.title,value:t.stats[e.value],precision:e["precision"]?e["precision"]:0,prefix:e["prefix"]?e["prefix"]:null}})],1)}))],2)},B=[],C={props:["clusterId"],data:function(){return{isLoading:!1,stats:null,statsToShow:[{title:"Orders",value:"number_of_orders"},{title:"Spend",value:"spend",precision:2,prefix:"$"},{title:"Saved",value:"saved",precision:2,prefix:"$"},{title:"Savings Potential",value:"savings_potential_next_12_months",precision:2,prefix:"$"}]}},created:function(){this.fetch()},computed:Object(s["a"])({},Object(h["c"])("clusterViewer",{startDate:"startDate",endDate:"endDate"})),watch:{},methods:{fetch:function(){var t=this;t.isLoading=!0;var e={};this.startDate&&(e["start_date"]=this.startDate),this.endDate&&(e["end_date"]=this.endDate),c.a.post(window.API_BASE+"/intelligence/clusters/"+this.clusterId+"/stats",e).then((function(e){t.isLoading=!1,t.stats=e.data})).catch((function(e){console.log(e),t.$message.error("Error loading cluster stats")}))}}},F=C,P=(r("b79e"),Object(O["a"])(F,L,B,!1,null,"2e659fe2",null)),T=P.exports,k=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{key:t.clusterViewerReloadKey},[r("v-chart",{key:t.graphReloadKey,attrs:{forceFit:!0,renderer:"svg",height:"400",data:t.graphDataToShow,scale:t.scale}},[t.selectedColourByOption?r("v-legend",{attrs:{"data-key":"Vendor"}}):t._e(),r("v-tooltip",{attrs:{showTitle:!1,crosshairs:t.tooltipCrosshairs,itemTpl:t.tooltipItemTpl}}),r("v-axis",{attrs:{dataKey:"x",title:{text:t.formatGraphLabel(t.xLabel)+(t.xUnit?" ("+t.xUnit+")":"")}}}),r("v-axis",{attrs:{dataKey:"cost_per_unit",title:{text:"Cost per "+t.costPerLabel}}}),r("v-point",{attrs:{position:"x*cost_per_unit",size:"size",color:"color",opacity:"opacity",tooltip:t.pointTooltip,shape:"circle","on-click":t.handlePointClicked}})],1)],1)},M=[],I=(r("7db0"),r("2ef0")),E=Object(m["extendMoment"])(g.a),A={props:["orders","graphReloadKey"],mixins:[d["a"]],computed:Object(s["a"])(Object(s["a"])({},Object(h["c"])("clusterViewer",{selectedOrders:"selectedOrders",selectedXOption:"selectedXOption",selectedColourByOption:"selectedColourByOption",selectedSizeByOption:"selectedSizeByOption",clusterViewerReloadKey:"clusterViewerReloadKey",startDate:"startDate",endDate:"endDate"})),{},{start_date:{get:function(){return this.startDate},set:function(t){this.setStartDate(t)}},end_date:{get:function(){return this.endDate},set:function(t){this.setEndDate(t)}},datesFromGraphData:function(){return I.map(this.graphData,"order_date_moment")},earliestDate:function(){return E.min(this.datesFromGraphData)},latestDate:function(){return E.max(this.datesFromGraphData)},graphDateRange:function(){var t=this.start_date,e=this.end_date;return t||(t=this.earliestDate),e||(e=this.latestDate),E.range(t,e)},xLabel:function(){return"Quantity"===this.xType?"Quantity":this.xType},xUnit:function(){return"volume"===this.xLabel?"cubic metres":""},costPerLabel:function(){return"Quantity"===this.xType?"unit":"volume"===this.xType?"cubic metre":this.xLabel},scale:function(){var t=this;return[{dataKey:"cost_per_unit",formatter:function(e){return t.formatCostGraph({cost:e,cost_currency:"USD"})}}]},graphDataToShow:function(){var t=this;return I.filter(this.graphData,(function(e){return!(e.order_date_moment&&E(e.order_date_moment).isValid()&&t.start_date&&e.order_date_moment.isBefore(t.start_date))&&!(e.order_date_moment&&E(e.order_date_moment).isValid()&&t.end_date&&e.order_date_moment.isAfter(t.end_date))}))},graphData:function(){var t=this,e=[];return I.each(this.orders,(function(r){var i=0,n=r["CHF_FLOAT"],a="None"!==r["Quantity"]?r["Quantity"]:1,s=r["total_quantity"],o=null;r["products"]&&r["products"].length&&r["products"][0]["normalisedMeasure"]&&(o=r["products"][0]["normalisedMeasure"]);var c={};r["products"]&&r["products"].length&&r["product_numeric_properties"]&&I.each(r["product_numeric_properties"],(function(t){var e={magnitude:t.propertyValue,property_type:t.propertyName,unit:t.propertyUnit};c[t.propertyName]=e})),r["properties"]=c,i="Quantity"===t.xType?s:o&&o["entity"]===t.xType?o["normalisedUnitMagnitude"]*a:null;var l=.7,u=I.map(t.selectedOrders,"_id");u.includes(r["_id"])&&(l=.9);var d="Other";if(null!==t.selectedColourByOption){var p=t.selectedColourByOption.key;if(p in r)d=r[p];else{var h=I.find(r["product_categorical_properties"],(function(e){return e["propertyName"]===t.selectedColourByOption.key}));h&&(d=h["propertyValue"])}}var f=null;if(t.selectedSizeByOption){var g=I.find(r["product_numeric_properties"],(function(e){return e["propertyName"]===t.selectedSizeByOption}));f=g?g["propertyValue"]:0}var m=null,y=null;r["PO Initial Create Date"]&&r["PO Initial Create Date"]["$date"]&&r["PO Initial Create Date"]["$date"]["$numberLong"]&&(y=E.unix(Number(r["PO Initial Create Date"]["$date"]["$numberLong"])/1e3),m=y.format("DD/MM/YYYY")),e.push({id:r["_id"],description:r["product_name"],vendor:r["Vendor"]?r["Vendor"]:"-",order_date:m||"-",order_date_moment:y,quantity:s,measure:o,cost:n,cost_per_unit:i?n/i:n,properties:c,x:i,opacity:l,color:d,size:f})})),e},xOptions:function(){var t=["Quantity"];return I.each(this.graphData,(function(e){null!==e["measure"]&&t.push(e["measure"]["entity"])})),I.uniq(t)},pointTooltip:function(){var t=this;return["description*x*cost_per_unit*order_date*vendor",function(e,r,i,n,a){if(r<1&&0!==r){var s=Number.parseFloat(r).toExponential(3),o=s.split("e");r=o[0]+" x 10<sup>"+o[1]+"</sup>"}return{name:e,x_description:"<b>"+t.formatGraphLabel(t.xLabel)+": </b>"+r+" "+t.xUnit,cost_per_unit:"<b>Cost per "+t.costPerLabel+": </b>"+t.formatCostGraph({cost:i,cost_currency:"USD"}),order_date:"<b>Order date: </b>"+n,vendor:"<b>Vendor: </b>"+a,value:t.xLabel+" ("+r+"), Cost per unit ("+t.formatCostGraph({cost:i,cost_currency:"USD"})+")"}}]},xType:{get:function(){return this.selectedXOption},set:function(t){this.selectXOption(t)}}}),data:function(){return{height:500,tooltipCrosshairs:{type:"cross"},tooltipItemTpl:'\n        <li data-index={index} style="margin-bottom:4px;">\n          <span style="background-color:{color};" class="g2-tooltip-marker"></span>\n          <b>{name}</b><br />\n          {x_description}<br />\n          {cost_per_unit}<br />\n          {order_date}<br />\n          {vendor}\n        </li>\n      '}},created:function(){this.setXOptions(this.xOptions),this.selectXOption("Quantity"),this.start_date||(this.start_date=this.earliestDate.clone()),this.end_date||(this.end_date=this.latestDate.clone())},methods:Object(s["a"])(Object(s["a"])({},Object(h["b"])("clusterViewer",{toggleOrderSelected:"toggleOrderSelected",setXOptions:"setXOptions",selectXOption:"selectXOption",setStartDate:"setStartDate",setEndDate:"setEndDate"})),{},{formatGraphLabel:function(t){return t.charAt(0).toUpperCase()+t.substring(1)},formatCostGraph:function(t){if(t.cost){var e=t.cost_currency?t.cost_currency:"GBP";return new Intl.NumberFormat("en-US",{style:"currency",currency:e,minimumFractionDigits:2,maximumFractionDigits:2}).format(t.cost)}return t.cost},handlePointClicked:function(t){var e=t["data"]["_origin"]["id"],r=I.find(this.orders,{_id:e});this.toggleOrderSelected(r)}})},j=A,U=(r("e231"),Object(O["a"])(j,k,M,!1,null,"984492b8",null)),R=U.exports,$=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("v-chart",{key:t.graphReloadKey,attrs:{forceFit:!0,renderer:"svg",height:"400",scale:t.scale,data:t.graphDataToShow}},[r("v-axis",{attrs:{dataKey:"quantity",title:{text:t.formatGraphLabel(t.xLabel)+(t.xUnit?" ("+t.xUnit+")":"")}}}),r("v-axis",{attrs:{dataKey:"order_date",title:{text:"Order Date"},tick:{tickCount:3}}}),r("v-tooltip",{attrs:{showTitle:!1,itemTpl:t.tooltipItemTpl}}),r("v-interval",{attrs:{tooltip:t.intervalTooltip,position:"order_date*quantity",opacity:1}})],1)],1)},z=[],G=(r("a630"),r("3ca3"),r("2ef0")),V=Object(m["extendMoment"])(g.a),Y={name:"ClusterDemandGraph",props:["orders","graphReloadKey"],data:function(){return{tooltipItemTpl:'\n        <li data-index={index} style="margin-bottom:4px;">\n          <span style="background-color:{color};" class="g2-tooltip-marker"></span>\n          <b>{name}</b><br />\n          {value}\n        </li>\n      '}},created:function(){},computed:Object(s["a"])(Object(s["a"])({},Object(h["c"])("clusterViewer",{selectedBinByOption:"selectedBinByOption",startDate:"startDate",endDate:"endDate",selectedXOption:"selectedXOption"})),{},{xType:{get:function(){return this.selectedXOption},set:function(t){this.selectXOption(t)}},start_date:{get:function(){return this.startDate},set:function(t){this.setStartDate(t)}},end_date:{get:function(){return this.endDate},set:function(t){this.setEndDate(t)}},scale:function(){return[{dataKey:"order_date",tickCount:10}]},xLabel:function(){return"Quantity"===this.xType?"Quantity":this.xType},xUnit:function(){return"volume"===this.xLabel?"cubic metres":""},graphData:function(){var t=this,e=[],r=G.filter(this.orders,(function(t){return t["PO Initial Create Date"]&&t["PO Initial Create Date"]["$date"]&&t["PO Initial Create Date"]["$date"]["$numberLong"]}));G.each(r,(function(r){var i=null,n=null;r["PO Initial Create Date"]&&r["PO Initial Create Date"]["$date"]&&r["PO Initial Create Date"]["$date"]["$numberLong"]&&(n=V.unix(Number(r["PO Initial Create Date"]["$date"]["$numberLong"])/1e3),i=n.format("DD/MM/YYYY")),r["order_date_moment"]=n,r["order_date"]=i;var a=null;r["products"]&&r["products"].length&&r["products"][0]["normalisedMeasure"]&&(a=r["products"][0]["normalisedMeasure"]);var s=null;if("Quantity"===t.xType)s=r["total_quantity"];else if(a&&a["entity"]===t.xType){var o="None"!==r["Quantity"]?r["Quantity"]:1;s=a["normalisedUnitMagnitude"]*o}null!==s&&e.push({_id:r["_id"],order_date:r["order_date"],order_date_moment:r["order_date_moment"],quantity:s})}));var i=[],n=G.groupBy(e,"order_date");return G.each(n,(function(t,e){var r=G.sum(G.map(t,"quantity"));i.push({order_date:e,order_date_moment:t[0]["order_date_moment"],quantity:r})})),i},datesFromGraphData:function(){return G.map(this.graphData,"order_date_moment")},earliestDate:function(){return V.min(this.datesFromGraphData)},latestDate:function(){return V.max(this.datesFromGraphData)},graphDateRange:function(){var t=this.start_date,e=this.end_date;return t||(t=this.earliestDate),e||(e=this.latestDate),V.range(t,e)},graphDateRangeByDays:function(){return Array.from(this.graphDateRange.by("days"))},graphDateRangeByMonths:function(){return Array.from(this.graphDateRange.by("months"))},graphDateRangeByYears:function(){return Array.from(this.graphDateRange.by("years"))},graphDataToShow:function(){var t=this,e=[];return"day"===this.selectedBinByOption&&G.each(this.graphDateRangeByDays,(function(r){var i=r.format("DD/MM/YYYY"),n=G.find(t.graphData,{order_date:i});n?e.push(n):e.push({order_date:i,quantity:0})})),"month"===this.selectedBinByOption&&G.each(this.graphDateRangeByMonths,(function(r){var i=V(r).startOf("month"),n=V(r).endOf("month"),a=V.range(i,n),s=[];G.each(Array.from(a.by("days")),(function(e){var r=e.format("DD/MM/YYYY"),i=G.find(t.graphData,{order_date:r});s.push(i)})),s&&e.push({order_date:i.format("MM/YYYY"),quantity:G.sum(G.map(s,"quantity"))})})),"year"===this.selectedBinByOption&&G.each(this.graphDateRangeByYears,(function(r){var i=V(r).startOf("year"),n=V(r).endOf("year"),a=V.range(i,n),s=[];G.each(Array.from(a.by("days")),(function(e){var r=e.format("DD/MM/YYYY"),i=G.find(t.graphData,{order_date:r});s.push(i)})),s&&e.push({order_date:i.format("YYYY"),quantity:G.sum(G.map(s,"quantity"))})})),e},intervalTooltip:function(){var t=this;return["order_date*quantity",function(e,r){if(r<1&&0!==r){var i=Number.parseFloat(r).toExponential(3),n=i.split("e");r=n[0]+" x 10<sup>"+n[1]+"</sup>"}return{name:e,value:r+" "+t.xUnit}}]}}),methods:Object(s["a"])(Object(s["a"])({},Object(h["b"])("clusterViewer",{setStartDate:"setStartDate",setEndDate:"setEndDate",selectXOption:"selectXOption"})),{},{formatGraphLabel:function(t){return t.charAt(0).toUpperCase()+t.substring(1)}})},N=Y,W=(r("bb5b"),Object(O["a"])(N,$,z,!1,null,"e99a0fdc",null)),X=W.exports,K=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t.isLoading?r("div",{staticStyle:{"text-align":"center"}},[r("a-spin")],1):t._e(),t.isLoading?t._e():r("a-table",{staticClass:"axpi-table small-th column-dividers",attrs:{scroll:{x:"max-content"},columns:t.columns,"data-source":t.tableData,loading:t.isLoading},scopedSlots:t._u([{key:"name",fn:function(e,i){return r("div",{},[r("div",{staticClass:"product-name-wrapper"},[r("div",{staticClass:"left"},[r("a",{attrs:{target:"_blank",href:i["URL"]?i["URL"]:"#"}},[r("a-avatar",{staticStyle:{"margin-right":"20px"},attrs:{size:"large",src:t.getImageSrc(i)}})],1)]),r("div",{staticClass:"right"},[r("a",{attrs:{target:"_blank",href:t.getProductLink(i)}},[t._v(" "+t._s(e)+" ")])])])])}},t._l(t.uniqueProperties,(function(e,i){return{key:e,fn:function(e){return r("div",{key:i},[r("span",{domProps:{innerHTML:t._s(e)}})])}}}))],null,!0)})],1)},Q=[],q=(r("99af"),r("07ac"),r("2909")),H=r("2ef0"),J=Object(m["extendMoment"])(g.a),Z={name:"AllProductDetailsTable",mixins:[p["a"]],data:function(){return{enriched:[],isLoading:!1}},created:function(){this.enrich()},computed:Object(s["a"])(Object(s["a"])({},Object(h["c"])("clusterViewer",{ordersWithMatchesFiltered:"ordersWithMatchesFiltered",selectedOrders:"selectedOrders",startDate:"startDate",endDate:"endDate"})),{},{start_date:{get:function(){return this.startDate},set:function(t){this.setStartDate(t)}},end_date:{get:function(){return this.endDate},set:function(t){this.setEndDate(t)}},datesFromTableData:function(){return H.map(this.tableData,"order_date_moment")},earliestDate:function(){return J.min(this.datesFromTableData)},latestDate:function(){return J.max(this.datesFromTableData)},tableDateRange:function(){var t=this.start_date,e=this.end_date;return t||(t=this.earliestDate),e||(e=this.latestDate),J.range(t,e)},uniqueProperties:function(){var t=[];return H.each(Object.values(this.enriched),(function(e){t.push(H.map(e,"propertyName")),t=H.flatten(t)})),H.uniq(t)},columns:function(){return[{title:"Name",dataIndex:"product_name",scopedSlots:{customRender:"name"},sorter:!0,width:350,fixed:"left"}].concat(Object(q["a"])(H.map(this.uniqueProperties,(function(t){return{title:t,dataIndex:t,sorter:!0,width:200,scopedSlots:{customRender:t}}}))),[{title:""}])},dataToShow:function(){var t=this,e=[];if(this.selectedOrders.length){var r=H.map(this.selectedOrders,"_id");e=H.filter(this.ordersWithMatchesFiltered,(function(t){return r.includes(t["_id"])}))}else e=this.ordersWithMatchesFiltered;return H.filter(e,(function(e){var r=null,i=null;return e["PO Initial Create Date"]&&e["PO Initial Create Date"]["$date"]&&e["PO Initial Create Date"]["$date"]["$numberLong"]&&(i=J.unix(Number(e["PO Initial Create Date"]["$date"]["$numberLong"])/1e3),r=i.format("DD/MM/YYYY")),e.order_date=r,e.order_date_moment=i,!(e.order_date_moment&&J(e.order_date_moment).isValid()&&t.startDate&&e.order_date_moment.isBefore(t.startDate))&&!(e.order_date_moment&&J(e.order_date_moment).isValid()&&t.endDate&&e.order_date_moment.isAfter(t.endDate))}))},tableData:function(){var t=this,e=[];return H.each(this.dataToShow,(function(r){if(r.product_name){var i={product_id:r.product_id,product_name:r.product_name,imageURLs:t.getFirstProduct(r)["imageURLs"],URL:t.getFirstProduct(r)["URL"]};H.each(t.uniqueProperties,(function(e){var n=H.find(r.product_all_properties,{propertyName:e});if(n)if(n.variableType&&"categorical"===n.variableType)i[e]=n.propertyValue;else{var a=n.propertyValue;if(a<1&&0!==a){var s=Number.parseFloat(a).toExponential(3),o=s.split("e");a=o[0]+" x 10<sup>"+o[1]+"</sup>"}var c=t.formatUnit(n.propertyUnit);i[e]=a+" "+c}else i[e]=""})),e.push(i)}})),H.uniqBy(e,"product_id")}}),methods:{getImageSrc:function(t){if(t["imageURLs"]&&t["imageURLs"].length)return t["imageURLs"][0]},getProductLink:function(t){return"/products/"+t["product_id"]},getFirstProduct:function(t){return t["products"][0]},enrich:function(){var t=this;t.isLoading=!0,c.a.post(window.API_BASE+"/products/enrich-many",{ids:H.map(this.ordersWithMatchesFiltered,"product_id")}).then((function(e){t.isLoading=!1,t.enriched=e.data})).catch((function(e){console.log(e),t.isLoading=!1,t.$message.error("Error getting order properties")}))}}},tt=Z,et=(r("93d2"),Object(O["a"])(tt,K,Q,!1,null,"5c83f338",null)),rt=et.exports,it={props:["clusterId","graphReloadKey"],components:{AllProductDetailsTable:rt,ClusterDemandGraph:X,ClusterStatsSidebar:T,ClusterOrdersGraph:R},data:function(){return{}},computed:Object(s["a"])(Object(s["a"])({},Object(h["c"])("clusterViewer",{activeGraph:"activeGraph",ordersWithMatchesFiltered:"ordersWithMatchesFiltered"})),{},{isLoading:function(){return!this.ordersWithMatchesFiltered.length},active_graph:{get:function(){return this.activeGraph},set:function(t){this.setActiveGraph(t)}}}),created:function(){},methods:Object(s["a"])({},Object(h["b"])("clusterViewer",{setActiveGraph:"setActiveGraph"}))},nt=it,at=(r("9e28"),Object(O["a"])(nt,w,x,!1,null,null,null)),st=at.exports,ot=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"sidebar-wrapper"},[r("loading-screen",{attrs:{"is-loading":t.isSaving}}),r("div",{staticClass:"top"},[r("a-page-header",{attrs:{title:"Add Order"},on:{back:function(e){return t.$emit("close")}}}),r("a-tabs",[r("a-tab-pane",{key:"manual",attrs:{tab:"Add Manually"}},[r("div",[r("div",{staticStyle:{"margin-bottom":"20px","text-align":"left"}},[r("a-input-search",{staticStyle:{width:"100%"},attrs:{placeholder:"Search orders"},on:{search:t.fetch},model:{value:t.searchQuery,callback:function(e){t.searchQuery=e},expression:"searchQuery"}})],1),r("a-table",{key:t.reloadKey,staticClass:"axpi-table",attrs:{columns:t.columns,"row-selection":t.rowSelection,"row-key":function(t){return t["_id"]},"data-source":t.data,pagination:t.pagination,loading:t.loading||t.searchQueryIsDirty},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"name",fn:function(e,i){return r("div",{},[r("div",{staticClass:"product-name-wrapper"},[r("div",{staticClass:"left"},[r("a-avatar",{staticStyle:{"margin-right":"20px"},attrs:{size:"large",src:i["match_details_images"]}})],1),r("div",{staticClass:"right"},[t._v(" "+t._s(i["match_details_names"][0])+" ")])])])}},{key:"cost",fn:function(e){return r("div",{},[t._v(" "+t._s(t.formatCost({cost:e,cost_currency:"USD"}))+" ")])}}])})],1)]),r("a-tab-pane",{key:"suggested",attrs:{tab:"Suggested Orders"}})],1)],1),r("div",{staticClass:"bottom"},[r("div",[r("span",[t._v(" "+t._s(t.selectedOrderIds.length)+" "+t._s(1===t.selectedOrderIds.length?"order":"orders")+" selected ")]),r("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"default"},on:{click:function(e){return e.preventDefault(),t.$emit("close")}}},[t._v("Cancel")]),r("a-button",{attrs:{type:"primary",disabled:!t.canSave},on:{click:function(e){return e.preventDefault(),t.save(e)}}},[t._v("Add to cluster")])],1)])],1)},ct=[],lt=r("2ef0"),ut=[{title:"Name",dataIndex:"Name",sorter:!0,scopedSlots:{customRender:"name"}},{title:"Cost",dataIndex:"CHF_FLOAT",scopedSlots:{customRender:"cost"},sorter:!0,width:110}],dt={name:"AddOrderToClusterButtonAndModal",props:["clusterId"],mixins:[d["a"]],data:function(){return{isSaving:!1,serverErrors:[],loading:!1,data:[],pagination:{},searchQuery:"",searchQueryIsDirty:!1,selectedOrderIds:[],columns:ut,reloadKey:1}},watch:{searchQuery:function(){this.searchQueryIsDirty=!0,this.fetch()}},created:function(){this.setup()},methods:{setup:function(){this.data=[],this.pagination={},this.searchQueryIsDirty=!1,this.selectedOrderIds=[],this.reloadKey+=1,this.fetch()},save:function(){var t=this;if(!this.canSave)return!1;t.isSaving=!0,c.a.post(window.API_BASE+"/intelligence/clusters/"+this.clusterId+"/add-orders",{erp_order_ids:this.selectedOrderIds}).then((function(){t.isSaving=!1,t.$message.success("Orders added to cluster successfully"),t.$emit("reload"),t.$emit("close")})).catch((function(e){console.log(e),t.isSaving=!1,t.$message.error("Error adding orders to cluster")}))},determineSearchParams:function(t){return Object(s["a"])({results_per_page:10,q:this.searchQuery,cluster_id:this.clusterId},t)},fetch:lt.debounce((function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=!0,c.a.post(window.API_BASE+"/intelligence/clusters/search-erp-orders",this.determineSearchParams(e)).then((function(e){var r=Object(s["a"])({},t.pagination);r.total=e.data.total,t.loading=!1,t.data=e.data.data,t.pagination=r,t.searchQueryIsDirty=!1})).catch((function(e){console.log(e),t.$message.error("Error searching ERP orders")}))}),500),handleTableChange:function(t,e,r){var i=Object(s["a"])({},this.pagination);i.current=t.current,this.pagination=i,this.fetch(Object(s["a"])({results_per_page:t.pageSize,page:t.current,sortField:r.field,sortOrder:r.order},e))}},computed:{canSave:function(){return this.selectedOrderIds.length>0},rowSelection:function(){var t=this;return{onChange:function(e){t.selectedOrderIds=e},getCheckboxProps:function(t){return{props:{disabled:"Disabled User"===t.name,name:t.name}}}}}}},pt=dt,ht=(r("481a"),Object(O["a"])(pt,ot,ct,!1,null,"01b229f0",null)),ft=ht.exports,gt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"sidebar-wrapper"},[r("div",{staticClass:"top"},[r("loading-screen",{attrs:{"is-loading":t.isSaving}}),r("a-page-header",{attrs:{title:t.headerTitle},on:{back:t.handleBack}}),null===t.insightType?r("insights-summary-table",{attrs:{insights:t.insights,"selected-order-id":t.erpOrderId},on:{"set-insight-type":t.setInsightType}}):t._e(),t.insightType?r("group-insights-table",{attrs:{"insights-applied-local":t.insightsAppliedLocal,insights:t.groupInsightsToShow},on:{"toggle-insight-applied":t.toggleInsightApplied}}):t._e()],1),r("div",{staticClass:"bottom"},[r("div",[r("a-button",{attrs:{type:"primary",disabled:!t.needsToSaveInsightsApplied},on:{click:function(e){return e.preventDefault(),t.persistInsightsApplied(e)}}},[t._v("Save ")])],1)])])},mt=[],yt=(r("fb6a"),r("7b84")),vt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"wrapper"},[t.insightsToShow.length?t._e():r("a-alert",{attrs:{type:"error",message:"No insights for this order"}}),t.insightsToShow.length?r("table",{staticClass:"axpi-basic-table"},[t._m(0),r("tbody",t._l(t.insightsGroupedByType,(function(e,i){return r("tr",{key:i},[r("td",[t._v(" "+t._s(t.formatType(i))+" ")]),r("td",[t._v(" "+t._s(t.formatCost({cost:t.getMinSavings(e),cost_currency:"USD"}))+" "),t.getMaxSavings(e)!==t.getMinSavings(e)?r("span",[t._v("- "+t._s(t.formatCost({cost:t.getMaxSavings(e),cost_currency:"USD"})))]):t._e()]),r("td",{staticClass:"action"},[r("a-button",{on:{click:function(e){return e.preventDefault(),t.$emit("set-insight-type",i)}}},[t._v("View")])],1)])})),0)]):t._e(),r("div",{staticClass:"wrapper insights-list-wrapper"})],1)},_t=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("thead",[r("tr",[r("th",[t._v("Name")]),r("th",[t._v("Potential Savings")]),r("th")])])}],bt=r("2ef0"),Ot={name:"InsightsSummaryTable",props:["insights","selectedOrderId"],mixins:[d["a"]],computed:{insightsToShow:function(){var t=this;return this.selectedOrderId&&this.insights.length?bt.filter(this.insights,(function(e){return String(e.erp_order_id)===String(t.selectedOrderId)})):this.insights.length?this.insights:[]},insightsGroupedByType:function(){return bt.groupBy(this.insights,"insight_type")}},methods:{formatType:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},getSavingsForGroupAndSelectedOrder:function(t){var e=this;return bt.sum(bt.map(bt.filter(t,(function(t){return String(t.erp_order_id)===String(e.selectedOrderId)})),"potential_savings"))},getMinSavings:function(t){var e=this;return bt.min(bt.map(bt.filter(t,(function(t){return String(t.erp_order_id)===String(e.selectedOrderId)})),"potential_savings"))},getMaxSavings:function(t){var e=this;return bt.max(bt.map(bt.filter(t,(function(t){return String(t.erp_order_id)===String(e.selectedOrderId)})),"potential_savings"))}}},St=Ot,Dt=Object(O["a"])(St,vt,_t,!1,null,"3757a7a8",null),wt=Dt.exports,xt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("table",{staticClass:"axpi-basic-table"},[t._m(0),t._l(t.insights,(function(e,i){return r("insight-row",{key:i,attrs:{"insights-applied-local":t.insightsAppliedLocal,insight:e},on:{"toggle-insight-applied":function(e){return t.$emit("toggle-insight-applied",e)}}})}))],2)])},Lt=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("thead",[r("tr",[r("th",{attrs:{colspan:"2"}},[t._v("Details")]),r("th",[t._v("Match")]),r("th",[t._v("Potential Savings")]),r("th")])])}],Bt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("tbody",[r("tr",{class:{"no-border-bottom":t.showMoreDetails}},[r("td",[r("a-avatar",{attrs:{size:"large",src:t.getImageSrc(t.getFirstProduct(t.insight))}})],1),r("td",[r("b",[t._v(t._s(t.getFirstProduct(t.insight)["name"]))]),t.showMoreDetails?t._e():r("div",[r("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.toggleShowMoreDetails(e)}}},[t._v("Compare "),r("a-icon",{style:{fontSize:"10px"},attrs:{type:"down"}})],1)])]),r("td",[t._v(t._s(t.matchPercentage)+"%")]),r("td",[t._v(" "+t._s(t.formatCost({cost:t.insight["potential_savings"],cost_currency:"USD"}))+" ")]),r("td",{staticClass:"action"},[t.isInsightSelected?r("a-button",{attrs:{type:"danger"},on:{click:function(e){return e.preventDefault(),t.toggleInsightApplied(e)}}},[t._v("Deselect")]):r("a-button",{on:{click:function(e){return e.preventDefault(),t.toggleInsightApplied(e)}}},[t._v("Select")])],1)]),t.showMoreDetails?r("tr",[r("td"),r("td",{attrs:{colspan:"4"}},[r("div",[r("div",{staticClass:"comparison-wrapper"},[r("a-row",{attrs:{gutter:5}},[r("a-col",{attrs:{span:12}},[r("p",[r("b",[t._v("Country ")]),r("br"),t._v(" "+t._s(t.getProperty("country"))+" "),t.doesPropertyMatch("country")?r("a-icon",{attrs:{type:"check-circle",theme:"twoTone","two-tone-color":"#52c41a"}}):r("a-icon",{attrs:{type:"close-circle",theme:"twoTone","two-tone-color":"#FF0000"}})],1),r("p",[r("b",[t._v("Vendor ")]),r("br"),t._v(" "+t._s(t.getProperty("vendor"))+" "),t.doesPropertyMatch("vendor")?r("a-icon",{attrs:{type:"check-circle",theme:"twoTone","two-tone-color":"#52c41a"}}):r("a-icon",{attrs:{type:"close-circle",theme:"twoTone","two-tone-color":"#FF0000"}})],1),r("p",[r("b",[t._v("Business unit ")]),r("br"),t._v(" "+t._s(t.selectedOrganisationalUnit?t.selectedOrganisationalUnit.name:"-")+" ")])]),r("a-col",{attrs:{span:12}},[r("p",[r("b",[t._v("Volume difference ")]),r("br"),t._v(" "+t._s(null!==t.volumePercentageDifference?t.volumePercentageDifference:0)+"% ")]),r("p",[r("b",[t._v("Unit price difference ")]),r("br"),t._v(" "+t._s(t.pricePerUnitPercentageDifference)+"% ")]),r("p",[r("b",[t._v("Time difference ")]),r("br"),t._v(" "+t._s(t.timeDifference)+" ")])])],1)],1),r("a",{staticStyle:{"margin-top":"5px"},attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.toggleShowMoreDetails(e)}}},[t._v("View less "),r("a-icon",{style:{fontSize:"10px"},attrs:{type:"up"}})],1)])])]):t._e()])},Ct=[],Ft=r("2ef0"),Pt={props:["insight","insightsAppliedLocal"],mixins:[d["a"]],data:function(){return{showMoreDetails:!1}},computed:Object(s["a"])(Object(s["a"])(Object(s["a"])({},Object(h["c"])("clusterViewer",{ordersWithMatches:"ordersWithMatches"})),Object(h["c"])("auth",{selectedOrganisationalUnit:"selectedOrganisationalUnit"})),{},{matchPercentage:function(){var t=this,e=["country","name","vendor"],r=[];return Ft.each(e,(function(e){t.doesPropertyMatch(e)&&r.push(e)})),Math.round(r.length/e.length*100)},baseVolume:function(){return this.getProperty("volume")},comparedToVolume:function(){return this.getProperty("volume","compared_to")},volumePercentageDifference:function(){var t=this.getProperty("volume","compared_to"),e=this.getProperty("volume");if(t&&e){var r=t-e,i=r/e*100;return Math.round(100*i)/100}return null},pricePerUnitPercentageDifference:function(){var t=this.insight["price_per_unit"]["base"],e=this.insight["price_per_unit"]["compared_to"],r=e-t,i=r/t*100;return Math.round(100*i)/100},isInsightSelected:function(){return this.insightsAppliedLocal.includes(this.insight["insight_id"])},timeDifference:function(){var t=Ft.find(this.ordersWithMatches,{_id:this.insight["compared_to_erp_order_id"]}),e=t["PO Initial Create Date"],r=null;if(e&&e["$date"]&&e["$date"]["$numberLong"]){var i=e["$date"]["$numberLong"]/1e3;r=g.a.unix(i)}var n=Ft.find(this.ordersWithMatches,{_id:this.insight["erp_order_id"]}),a=n["PO Initial Create Date"],s=null;if(a&&a["$date"]&&a["$date"]["$numberLong"]){var o=a["$date"]["$numberLong"]/1e3;s=g.a.unix(o)}return r&&s?r.from(s):"-"}}),methods:{getFirstProduct:function(t){var e=Ft.find(this.ordersWithMatches,{_id:t["compared_to_erp_order_id"]});return e["products"][0]},getBaseErpOrder:function(t){return Ft.find(this.ordersWithMatches,{_id:t["erp_order_id"]})},getComparedToErpOrder:function(t){return Ft.find(this.ordersWithMatches,{_id:t["compared_to_erp_order_id"]})},getFirstBaseProduct:function(t){var e=Ft.find(this.ordersWithMatches,{_id:t["erp_order_id"]});return e["products"][0]},toggleShowMoreDetails:function(){this.showMoreDetails=!this.showMoreDetails},getImageSrc:function(t){if(t["imageURLs"]&&t["imageURLs"].length)return t["imageURLs"][0]},getProperty:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"compared_to";switch(t){case"country":return"compared_to"===e?this.getFirstProduct(this.insight)["country"]:this.getFirstBaseProduct(this.insight)["country"];case"name":return"compared_to"===e?this.getFirstProduct(this.insight)["name"]:this.getFirstBaseProduct(this.insight)["name"];case"vendor":return"compared_to"===e?this.getFirstProduct(this.insight)["vendor"]:this.getFirstBaseProduct(this.insight)["vendor"];case"volume":var r=null;r="compared_to"===e?this.getFirstProduct(this.insight):this.getFirstBaseProduct(this.insight);var i=null;return r["normalisedQuantity"]&&"volume"===r["normalisedQuantity"]["entity"]&&(i=r["normalisedQuantity"]["normalisedUnitMagnitude"]),i;default:return null}},doesPropertyMatch:function(t){return this.getProperty(t)===this.getProperty(t,"base")},toggleInsightApplied:function(){this.$emit("toggle-insight-applied",this.insight)}}},Tt=Pt,kt=(r("5cbb9"),Object(O["a"])(Tt,Bt,Ct,!1,null,"27a0ab92",null)),Mt=kt.exports,It={name:"GroupInsightsTable",components:{InsightRow:Mt},props:["insights","insightsAppliedLocal"],methods:{}},Et=It,At=Object(O["a"])(Et,xt,Lt,!1,null,"419ba138",null),jt=At.exports,Ut=r("2ef0"),Rt={name:"InsightsSidebar",props:["clusterId","erpOrderId","insightsApplied"],components:{InsightsSummaryTable:wt,GroupInsightsTable:jt,LoadingScreen:yt["default"]},data:function(){return{insightType:null,insightsAppliedSaved:[],insightsAppliedLocal:[],isSaving:!1}},watch:{erpOrderId:function(){this.insightType=null,this.insightsAppliedLocal=Ut.cloneDeep(this.insightsApplied)}},created:function(){this.insightsAppliedSaved=Ut.cloneDeep(this.insightsApplied),this.insightsAppliedLocal=Ut.cloneDeep(this.insightsApplied)},methods:{setInsightType:function(t){this.insightType=t},handleBack:function(){this.insightType?this.insightType=null:this.$emit("close")},toggleInsightApplied:function(t){this.insightsAppliedLocal=Ut.xor(this.insightsAppliedLocal,[t["insight_id"]])},persistInsightsApplied:function(){if(!this.needsToSaveInsightsApplied)return!1;var t=this;t.isSaving=!0,c.a.put(window.API_BASE+"/intelligence/clusters/"+this.clusterId,{insight_ids:t.insightsAppliedLocal}).then((function(){t.$emit("insights-saved",t.insightsAppliedLocal),t.insightsAppliedSaved=t.insightsAppliedLocal,t.$message.success("Insights saved successfully"),t.isSaving=!1})).catch((function(e){console.log(e),t.isSaving=!1,t.$message.error("Error saving insights")}))}},computed:Object(s["a"])(Object(s["a"])({},Object(h["c"])("clusterViewer",{insights:"insights"})),{},{headerTitle:function(){return this.insightType?this.insightType.charAt(0).toUpperCase()+this.insightType.slice(1)+" Insights":"Insights"},groupInsightsToShow:function(){var t=this;return Ut.filter(this.insights,(function(e){var r=String(e.erp_order_id)===String(t.erpOrderId),i=String(e.insight_type)===String(t.insightType);return r&&i}))},needsToSaveInsightsApplied:function(){var t=Ut.difference(this.insightsAppliedLocal,this.insightsAppliedSaved),e=Ut.difference(this.insightsAppliedSaved,this.insightsAppliedLocal);return Ut.union(t,e).length>0}})},$t=Rt,zt=(r("efa9"),Object(O["a"])($t,gt,mt,!1,null,"233a31f8",null)),Gt=zt.exports,Vt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"cluster-filters",staticStyle:{display:"inline"}},[r("a-popover",{attrs:{placement:"bottomRight",trigger:"click"}},[r("template",{slot:"title"},[r("div",{staticClass:"filter-title-wrapper"},[r("div",{staticClass:"left"},[r("a-button",{attrs:{size:"small"},on:{click:function(e){return e.preventDefault(),t.clear(e)}}},[t._v("Clear")])],1),r("div",{staticClass:"center"},[t._v(" Filters ")]),r("div",{staticClass:"right"},[r("a-button",{attrs:{disabled:!t.hasUnsavedChanges,type:"primary",size:"small"},on:{click:t.save}},[t._v("Save ")])],1)])]),r("template",{slot:"content"},[r("div",{staticClass:"filters-inner"},[r("div",[r("div",{staticClass:"filter-wrapper"},[r("div",{staticClass:"filter-header"},[r("a-checkbox",{model:{value:t.showSelectedXOptionFilter,callback:function(e){t.showSelectedXOptionFilter=e},expression:"showSelectedXOptionFilter"}},[t._v(" Measure ")])],1),t.showSelectedXOptionFilter?r("div",{staticClass:"filter"},[r("a-select",{staticStyle:{width:"200px"},model:{value:t.selectedXOptionLocal,callback:function(e){t.selectedXOptionLocal=e},expression:"selectedXOptionLocal"}},t._l(t.xOptions,(function(e,i){return r("a-select-option",{key:i,attrs:{value:e}},[t._v(" "+t._s(t.formatGraphLabel(e))+" ")])})),1)],1):t._e()]),r("div",{staticClass:"filter-wrapper"},[r("div",{staticClass:"filter-header"},[r("a-checkbox",{model:{value:t.showStartDateFilter,callback:function(e){t.showStartDateFilter=e},expression:"showStartDateFilter"}},[t._v(" Start Date ")])],1),t.showStartDateFilter?r("div",{staticClass:"filter"},[r("a-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"Start"},model:{value:t.startDateLocal,callback:function(e){t.startDateLocal=e},expression:"startDateLocal"}})],1):t._e()]),r("div",{staticClass:"filter-wrapper filter-last"},[r("div",{staticClass:"filter-header"},[r("a-checkbox",{model:{value:t.showEndDateFilter,callback:function(e){t.showEndDateFilter=e},expression:"showEndDateFilter"}},[t._v(" End Date ")])],1),t.showEndDateFilter?r("div",{staticClass:"filter"},[r("a-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"End"},model:{value:t.endDateLocal,callback:function(e){t.endDateLocal=e},expression:"endDateLocal"}})],1):t._e()])]),"orders"===t.activeGraph?r("div",[r("div",{staticClass:"filter-wrapper filter-last"},[r("div",{staticClass:"filter-header"},[r("a-checkbox",{model:{value:t.showSelectedColourByOptionFilter,callback:function(e){t.showSelectedColourByOptionFilter=e},expression:"showSelectedColourByOptionFilter"}},[t._v(" Colour ")])],1),t.showSelectedColourByOptionFilter?r("div",{staticClass:"filter"},[r("a-select",{staticStyle:{width:"200px"},model:{value:t.selectedColourByOptionLocal,callback:function(e){t.selectedColourByOptionLocal=e},expression:"selectedColourByOptionLocal"}},t._l(t.colourByOptions,(function(e){return r("a-select-option",{key:e.key,attrs:{value:e.key}},[t._v(" "+t._s(e["label"])+" ")])})),1)],1):t._e()]),r("div",{staticClass:"filter-wrapper filter-last"},[r("div",{staticClass:"filter-header"},[r("a-checkbox",{model:{value:t.showSelectedSizeByOptionFilter,callback:function(e){t.showSelectedSizeByOptionFilter=e},expression:"showSelectedSizeByOptionFilter"}},[t._v(" Size ")])],1),t.showSelectedSizeByOptionFilter?r("div",{staticClass:"filter"},[r("a-select",{staticStyle:{width:"200px"},model:{value:t.selectedSizeByOptionLocal,callback:function(e){t.selectedSizeByOptionLocal=e},expression:"selectedSizeByOptionLocal"}},t._l(t.sizeByOptions,(function(e,i){return r("a-select-option",{key:i,attrs:{value:e}},[t._v(" "+t._s(e)+" ")])})),1)],1):t._e()])]):t._e(),"demand"===t.activeGraph?r("div",[r("div",{staticClass:"filter-wrapper"},[r("div",{staticClass:"filter-header"},[r("a-checkbox",{model:{value:t.showSelectedBinByOptionFilter,callback:function(e){t.showSelectedBinByOptionFilter=e},expression:"showSelectedBinByOptionFilter"}},[t._v(" Bin ")])],1),t.showSelectedBinByOptionFilter?r("div",{staticClass:"filter"},[r("a-select",{staticStyle:{width:"200px"},model:{value:t.selectedBinByOptionLocal,callback:function(e){t.selectedBinByOptionLocal=e},expression:"selectedBinByOptionLocal"}},t._l(t.binByOptions,(function(e,i){return r("a-select-option",{key:i,attrs:{value:e}},[t._v(" "+t._s(t.formatGraphLabel(e))+" ")])})),1)],1):t._e()])]):t._e()])]),r("a-button",{attrs:{icon:"line-chart"}},[t._v("Graph")])],2)],1)},Yt=[],Nt=r("2ef0"),Wt={name:"ClusterFilters",data:function(){return{binByOptions:["day","month","year"],showSelectedXOptionFilter:!0,selectedXOptionLocal:null,showSelectedColourByOptionFilter:!1,selectedColourByOptionLocal:null,showSelectedSizeByOptionFilter:!1,selectedSizeByOptionLocal:null,showSelectedBinByOptionFilter:!1,selectedBinByOptionLocal:null,showStartDateFilter:!1,startDateLocal:null,showEndDateFilter:!1,endDateLocal:null}},created:function(){this.selectedXOptionLocal=this.selectedXOption,this.selectedColourByOptionLocal=this.selectedColourByOption,this.selectedColourByOptionLocal&&(this.showSelectedColourByOptionFilter=!0),this.selectedSizeByOptionLocal=this.selectedSizeByOption,this.selectedSizeByOptionLocal&&(this.showSelectedSizeByOptionFilter=!0),this.selectedBinByOptionLocal=this.selectedBinByOption,this.selectedBinByOptionLocal&&(this.showSelectedBinByOptionFilter=!0),this.startDateLocal=this.startDate,this.startDateLocal&&(this.showStartDateFilter=!0),this.endDateLocal=this.endDate,this.endDateLocal&&(this.showEndDateFilter=!0)},watch:{selectedXOption:function(t){this.selectedXOptionLocal=t,t&&(this.showSelectedXOptionFilter=!0)},selectedColourByOption:function(t){t?(this.showSelectedColourByOptionFilter=!0,this.selectedColourByOptionLocal=t["key"]):this.selectedColourByOptionLocal=null},selectedBinByOption:function(t){this.selectedBinByOptionLocal=t,t&&(this.showSelectedBinByOptionFilter=!0)},startDate:function(t){this.startDateLocal=t},endDate:function(t){this.endDateLocal=t}},computed:Object(s["a"])(Object(s["a"])({},Object(h["c"])("clusterViewer",{activeGraph:"activeGraph",xOptions:"xOptions",selectedXOption:"selectedXOption",colourByOptions:"colourByOptions",selectedColourByOption:"selectedColourByOption",sizeByOptions:"sizeByOptions",selectedSizeByOption:"selectedSizeByOption",selectedBinByOption:"selectedBinByOption",startDate:"startDate",endDate:"endDate"})),{},{xType:{get:function(){return this.selectedXOption},set:function(t){this.selectXOption(t)}},colourBy:{get:function(){return this.selectedColourByOption},set:function(t){this.selectColourByOption(t)}},sizeBy:{get:function(){return this.selectedSizeByOption},set:function(t){this.selectSizeByOption(t)}},binBy:{get:function(){return this.selectedBinByOption},set:function(t){this.selectBinByOption(t)}},hasUnsavedChanges:function(){var t=!1;return this.selectedXOptionLocal!==this.selectedXOption&&(t=!0),!this.showSelectedColourByOptionFilter&&this.selectedColourByOption&&(t=!0),this.selectedColourByOptionLocal!==this.selectedColourByOption&&(t=!0),!this.showSelectedSizeByOptionFilter&&this.selectedSizeByOption&&(t=!0),this.selectedSizeByOptionLocal!==this.selectedSizeByOption&&(t=!0),this.showSelectedBinByOptionFilter&&this.selectedBinByOption&&(t=!0),this.selectedBinByOptionLocal!==this.selectedBinByOption&&(t=!0),this.showStartDateFilter&&this.startDate&&(t=!0),this.startDateLocal!==this.startDate&&(t=!0),this.showEndDateFilter&&this.endDate&&(t=!0),this.endDateLocal!==this.endDate&&(t=!0),t}}),methods:Object(s["a"])(Object(s["a"])({},Object(h["b"])("clusterViewer",{selectXOption:"selectXOption",selectColourByOption:"selectColourByOption",selectSizeByOption:"selectSizeByOption",selectBinByOption:"selectBinByOption",setStartDate:"setStartDate",setEndDate:"setEndDate",incrementClusterViewerReloadKey:"incrementClusterViewerReloadKey"})),{},{clear:function(){this.showSelectedXOptionFilter=!1,this.showSelectedColourByOptionFilter=!1,this.showSelectedSizeByOptionFilter=!1,this.save(),this.incrementClusterViewerReloadKey()},save:function(){this.showSelectedXOptionFilter?this.selectXOption(this.selectedXOptionLocal):this.selectXOption("Quantity"),this.showSelectedColourByOptionFilter?this.selectColourByOption(Nt.find(this.colourByOptions,{key:this.selectedColourByOptionLocal})):this.selectColourByOption(null),this.showSelectedSizeByOptionFilter?this.selectSizeByOption(this.selectedSizeByOptionLocal):this.selectSizeByOption(null),this.showSelectedBinByOptionFilter?this.selectBinByOption(this.selectedBinByOptionLocal):this.selectBinByOption("day"),this.showStartDateFilter?this.setStartDate(this.startDateLocal):this.setStartDate(null),this.showEndDateFilter?this.setEndDate(this.endDateLocal):this.setEndDate(null),this.incrementClusterViewerReloadKey()},formatGraphLabel:function(t){return t.charAt(0).toUpperCase()+t.substring(1)}})},Xt=Wt,Kt=Object(O["a"])(Xt,Vt,Yt,!1,null,"5366bb4c",null),Qt=Kt.exports,qt=r("f23f"),Ht=r("2ef0"),Jt={name:"Show",components:{ClusterFilters:Qt,InsightsSidebar:Gt,ClusterOrdersTable:D,ClusterGraphs:st,Sidebar:ft},created:function(){this.loadCluster(this.$route.params.id)},data:function(){return{reloadKey:1,graphReloadKey:1,shouldShowSidebar:!1,sidebarType:"add-order",selectedErpOrderId:null,isDeleting:!1,isLoading:!1,isLoadingInsights:!1,isLoadingOrdersWithMatches:!1}},computed:Object(s["a"])(Object(s["a"])({},Object(h["c"])("clusterViewer",{cluster:"cluster",activeGraph:"activeGraph",ordersWithMatchesFiltered:"ordersWithMatchesFiltered"})),{},{shouldHideSidebar:function(){return!this.shouldShowSidebar},insightsApplied:function(){return this.cluster["insights_applied"]?this.cluster["insights_applied"]:[]},exportData:function(){return Ht.map(this.ordersWithMatchesFiltered,(function(t){var e={Name:t["PO Li Description"]},r=t["PO Initial Create Date"];if(r&&r["$date"]&&r["$date"]["$numberLong"]){var i=r["$date"]["$numberLong"]/1e3;e["Date Purchased"]=g.a.unix(i).format("DD/MM/YYYY")}else e["Date Purchased"]="-";return e["Quantity"]=t["total_quantity"]?t["total_quantity"]:Number(t["Quantity"]),e}))}}),watch:{$route:function(){this.loadCluster(this.$route.params.id)}},methods:Object(s["a"])(Object(s["a"])({},Object(h["b"])("clusterViewer",{setCluster:"setCluster",setSelectedOrders:"setSelectedOrders",setInsights:"setInsights",setOrdersWithMatches:"setOrdersWithMatches",setActiveGraph:"setActiveGraph"})),{},{exportCsv:function(){var t={fieldSeparator:",",quoteStrings:'"',decimalSeparator:".",showLabels:!0,showTitle:!0,title:this.cluster.name,useTextFile:!1,useBom:!0,useKeysAsHeaders:!0,filename:this.cluster.name},e=new qt["ExportToCsv"](t);e.generateCsv(this.exportData)},backToAllClusters:function(){this.$router.push("/intelligence/clusters")},toggleSidebar:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"add-order",e=this;if(t!==this.sidebarType)return console.log(t),console.log(this.sidebarType),this.sidebarType=t,this.shouldShowSidebar||(this.shouldShowSidebar=!0),window.setTimeout((function(){e.graphReloadKey+=1}),250),!1;this.shouldShowSidebar=!this.shouldShowSidebar,window.setTimeout((function(){e.graphReloadKey+=1}),250)},viewInsightsFor:function(t){var e=this;this.sidebarType="insights",this.selectedErpOrderId=t["_id"],this.shouldShowSidebar||(this.shouldShowSidebar=!0),window.setTimeout((function(){e.graphReloadKey+=1}),250)},loadCluster:function(t){var e=this;this.setCluster(null),this.setOrdersWithMatches([]),this.setInsights([]),this.setActiveGraph("orders"),e.isLoading=!0,c.a.get(window.API_BASE+"/intelligence/clusters/"+t).then((function(t){e.isLoading=!1,e.setCluster(t.data),e.loadInsights(),e.loadOrdersWithMatches(),e.setSelectedOrders([])})).catch((function(t){var r;e.isLoading=!1,e.$message.error("Error loading cluster"),console.log(t),r=t.response&&t.response.data&&"object"===Object(a["a"])(t.response.data)?Ht.flatten(Ht.toArray(t.response.data.errors)):["Something went wrong. Please try again."],e.serverErrors=r}))},loadOrdersWithMatches:function(){var t=this;t.setOrdersWithMatches([]),t.isLoadingOrdersWithMatches=!0,c.a.get(window.API_BASE+"/intelligence/clusters/"+t.cluster["_id"]+"/orders-with-matches").then((function(e){t.isLoadingOrdersWithMatches=!1,t.setOrdersWithMatches(e.data)})).catch((function(e){var r;t.isLoadingOrdersWithMatches=!1,t.$message.error("Error loading orders with matches"),console.log(e),r=e.response&&e.response.data&&"object"===Object(a["a"])(e.response.data)?Ht.flatten(Ht.toArray(e.response.data.errors)):["Something went wrong. Please try again."],t.serverErrors=r}))},loadInsights:function(){var t=this;t.setInsights([]),t.isLoadingInsights=!0,c.a.get(window.API_BASE+"/intelligence/clusters/"+t.cluster["_id"]+"/insights").then((function(e){t.isLoadingInsights=!1,t.setInsights(e.data)})).catch((function(e){var r;t.isLoadingInsights=!1,t.$message.error("Error loading insights"),console.log(e),r=e.response&&e.response.data&&"object"===Object(a["a"])(e.response.data)?Ht.flatten(Ht.toArray(e.response.data.errors)):["Something went wrong. Please try again."],t.serverErrors=r}))},incrementReloadKey:function(){this.reloadKey+=1},removeOrder:function(t){var e=this,r=this;r.isDeleting=!0,c.a.post(window.API_BASE+"/intelligence/clusters/"+this.cluster["_id"]+"/remove-order",{erp_order_id:t["_id"]}).then((function(){r.isDeleting=!1,r.$message.success("Order removed successfully"),r.loadCluster(e.cluster["_id"])})).catch((function(t){console.log(t),r.isDeleting=!1,r.$message.error("Error removing order")}))}})},Zt=Jt,te=(r("f6c0"),Object(O["a"])(Zt,i,n,!1,null,"bfd275ca",null));e["default"]=te.exports},efa9:function(t,e,r){"use strict";r("3187")},f1f1:function(t,e,r){},f23f:function(t,e,r){"use strict";function i(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}Object.defineProperty(e,"__esModule",{value:!0}),i(r("5e58"))},f6c0:function(t,e,r){"use strict";r("3854")}}]);
//# sourceMappingURL=view-cluster.7008c3f6.js.map
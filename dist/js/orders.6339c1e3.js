(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["orders"],{"0b90":function(e,t,r){},"159d":function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"home"},[r("loading-screen",{attrs:{"is-loading":e.isLoadingSuppliers||e.isDeleting}}),r("div",{staticClass:"page-header"},[r("h1",{staticClass:"page-title"},[e._v("Orders")]),r("div",{staticClass:"actions"},[r("a-input-search",{staticStyle:{width:"200px"},attrs:{placeholder:"Search orders"},model:{value:e.searchQuery,callback:function(t){e.searchQuery=t},expression:"searchQuery"}}),r("orders-filters",{attrs:{filters:e.filters},on:{"filter-updated":e.handleFilterUpdated,"set-filters":e.setFilters}}),r("a-button",{attrs:{icon:"export"}},[e._v("Export")]),r("a-button",{attrs:{icon:"form",loading:e.isRequestingInformation,disabled:0==e.selectedOrderIds.length},on:{click:e.requestInformation}},[e._v("Request Information ")]),r("a-button",{attrs:{icon:"plus",type:"primary",loading:e.isLoading},on:{click:e.createOrder}},[e._v("Add Order ")])],1)]),r("orders-table",{attrs:{"search-query":e.searchQuery,filters:e.filters,"reload-key":e.reloadOrdersKey},on:{"set-selected-order-ids":e.setSelectedOrderIds,"delete-order":e.deleteOrder,selected:e.handleOrderSelected}}),e.order&&"order"===e.type?r("edit-order-modal",{attrs:{suppliers:e.suppliers}}):e._e()],1)},a=[],n=r("5530"),i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("a-tabs",{model:{value:e.statusToShow,callback:function(t){e.statusToShow=t},expression:"statusToShow"}},[r("a-tab-pane",{key:null,attrs:{tab:"All"}}),r("a-tab-pane",{key:0,attrs:{tab:"Incomplete"}}),r("a-tab-pane",{key:1,attrs:{tab:"Ready To Send"}}),r("a-tab-pane",{key:2,attrs:{tab:"Sent"}}),r("a-tab-pane",{key:3,attrs:{tab:"Rejected"}}),r("a-tab-pane",{key:4,attrs:{tab:"Completed"}})],1),r("a-table",{staticClass:"axpi-table",attrs:{"row-selection":e.rowSelection,columns:e.columns,"row-key":function(e){return e.id},"data-source":e.data,pagination:e.pagination,loading:e.loading||e.searchQueryIsDirty},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"name",fn:function(t,s){return r("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.handleRecordSelected(s)}}},[e._v(e._s(t))])}},{key:"status",fn:function(t){return r("div",{},[r("a-badge",{attrs:{count:e.getHumanReadableStatus(t),"number-style":e.getStatusBadgeStyle(t)}})],1)}},{key:"type",fn:function(t){return r("div",{},[e._v(" "+e._s(e.formatType(t))+" ")])}},{key:"cost",fn:function(t,s){return r("div",{},[e._v(" "+e._s(e.formatCostInPence(s))+" ")])}},{key:"order_date",fn:function(t){return r("div",{},[e._v(" "+e._s(t?e.formatDate(t):null)+" ")])}},{key:"updated_at",fn:function(t){return r("div",{},[e._v(" "+e._s(e.displayTimeAgo(t))+" ")])}},{key:"actions",fn:function(t,s){return r("div",{staticClass:"table-actions"},[r("a-dropdown",{attrs:{trigger:["click"]}},[r("a-button",{attrs:{type:"link",icon:"ellipsis"},on:{click:function(e){return e.preventDefault(),function(e){return e.preventDefault()}(e)}}}),r("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[r("a-menu-item",[r("a",{attrs:{href:"#"},on:{click:function(t){return e.editOrder(s)}}},[e._v("Edit")])]),r("a-menu-item",[r("a",{staticClass:"text-danger",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.deleteRecord(s)}}},[e._v("Delete")])])],1)],1)],1)}}])})],1)},o=[],l=(r("b0c0"),r("bc3a")),d=r.n(l),c=r("2d20"),u=r("6e12"),f=r("2ef0"),p=[{title:"Name",dataIndex:"product_name",sorter:!0,scopedSlots:{customRender:"name"}},{title:"Status",dataIndex:"status",sorter:!0,scopedSlots:{customRender:"status"}},{title:"Type",dataIndex:"product_type",sorter:!0,scopedSlots:{customRender:"type"}},{title:"Cost",dataIndex:"cost",sorter:!0,scopedSlots:{customRender:"cost"}},{title:"Supplier",dataIndex:"supplier.name",sorter:!0},{title:"Order Date",dataIndex:"order_date",sorter:!0,scopedSlots:{customRender:"order_date"}},{title:"Last Updated",dataIndex:"updated_at",sorter:!0,scopedSlots:{customRender:"updated_at"}},{title:"",scopedSlots:{customRender:"actions"},width:10}],h={props:["reloadKey","searchQuery","filters"],data:function(){return{data:[],pagination:{},searchQueryIsDirty:!1,loading:!1,statusToShow:null,columns:p,selectedOrderIds:[]}},mixins:[c["a"],u["a"]],mounted:function(){this.fetch()},watch:{statusToShow:function(){this.fetch()},reloadKey:function(){this.fetch()},selectedOrderIds:function(e){this.$emit("set-selected-order-ids",e)},searchQuery:function(){this.searchQueryIsDirty=!0,this.fetch()}},computed:{rowSelection:function(){var e=this;return{onChange:function(t){e.selectedOrderIds=t},getCheckboxProps:function(e){return{props:{disabled:"Disabled User"===e.name,name:e.name}}}}}},methods:{handleTableChange:function(e,t,r){var s=Object(n["a"])({},this.pagination);s.current=e.current,this.pagination=s,this.fetch(Object(n["a"])({results_per_page:e.pageSize,page:e.current,sortField:r.field,sortOrder:r.order},t))},determineSearchParams:function(e){var t=this,r={results_per_page:10,status:this.statusToShow,q:this.searchQuery};return this.filters&&this.filters.filters_enabled.length&&(r.filters={},f.each(this.filters.filters_enabled,(function(e){r.filters[e]=t.filters[e]}))),console.log(r),Object(n["a"])(Object(n["a"])({},r),e)},fetch:f.debounce((function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=!0,d.a.post(window.API_BASE+"/orders/search",this.determineSearchParams(t)).then((function(t){var r=Object(n["a"])({},e.pagination);r.total=t.data.total,e.loading=!1,e.data=t.data.data,e.pagination=r,e.searchQueryIsDirty=!1})).catch((function(t){console.log(t),e.$message.error("Error loading orders")}))}),500),handleRecordSelected:function(e){this.$router.push("/orders/"+e.id)},editOrder:function(e){this.$emit("selected",e)},deleteRecord:function(e){this.$emit("delete-order",e)},getStatusBadgeStyle:function(e){return{backgroundColor:this.getStatusColor(e)}}}},g=h,m=r("2877"),b=Object(m["a"])(g,i,o,!1,null,null,null),v=b.exports,y=r("655a"),_=r("3683"),O=r("2f62"),S={name:"Orders",computed:Object(n["a"])({},Object(O["c"])("orderEditor",{type:"type",order:"order",reloadOrdersKey:"reloadOrdersKey",isLoading:"isLoading"})),components:{OrdersTable:v,EditOrderModal:y["a"],OrdersFilters:_["a"]},data:function(){return{suppliers:[],isLoadingSuppliers:!1,isRequestingInformation:!1,selectedOrderIds:[],isDeleting:!1,searchQuery:"",filters:{filters_enabled:{}}}},created:function(){this.loadSuppliers()},methods:Object(n["a"])(Object(n["a"])({},Object(O["b"])("orderEditor",{loadOrder:"loadOrder",setWizardStage:"setWizardStage",createOrder:"createOrder",incrementReloadOrdersKey:"incrementReloadOrdersKey"})),{},{setFilters:function(e){this.filters=e},loadSuppliers:function(){var e=this;e.isLoadingSuppliers=!0,d.a.get(window.API_BASE+"/suppliers").then((function(t){e.suppliers=t.data,e.isLoadingSuppliers=!1})).catch((function(t){console.log(t),e.isLoadingSuppliers=!1,e.$message.error("Error loading suppliers")}))},requestInformation:function(){var e=this,t=this;if(0===t.selectedOrderIds.length)return!1;t.isRequestingInformation=!0,d.a.post(window.API_BASE+"/request-information",{ids:t.selectedOrderIds}).then((function(){t.isRequestingInformation=!1,t.$message.success("Information requested successfully"),t.incrementReloadOrdersKey()})).catch((function(r){console.log(r),t.isRequestingInformation=!1,e.$message.error("Error requesting information")}))},deleteOrder:function(e){var t=this;t.isDeleting=!0,d.a.delete(window.API_BASE+"/orders/"+e.id).then((function(){t.isDeleting=!1,t.$message.success("Order deleted successfully"),t.incrementReloadOrdersKey()})).catch((function(e){console.log(e),t.isDeleting=!1,t.$message.success("Error deleting order")}))},setSelectedOrderIds:function(e){this.selectedOrderIds=e},handleOrderSelected:function(e){this.setWizardStage(0),this.loadOrder(e.id)},handleFilterUpdated:function(){this.incrementReloadOrdersKey()}})},k=S,w=Object(m["a"])(k,s,a,!1,null,null,null);t["default"]=w.exports},3683:function(e,t,r){"use strict";var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a-popover",{attrs:{placement:"bottomLeft",trigger:"click"}},[r("template",{slot:"title"},[r("div",{staticClass:"filter-title-wrapper"},[r("div",{staticClass:"left"},[r("a-button",{attrs:{size:"small"},on:{click:function(t){return t.preventDefault(),e.clear(t)}}},[e._v("Clear")])],1),r("div",{staticClass:"center"},[e._v(" Filters ")]),r("div",{staticClass:"right"},[r("a-button",{key:e.unsavedReloadKey,attrs:{disabled:!e.hasUnsavedChanges,type:"primary",size:"small"},on:{click:e.save}},[e._v("Save ")])],1)])]),r("template",{slot:"content"},[r("div",{staticClass:"filters-inner"},[r("inline-filter",{attrs:{filters:e.filtersLocal,id:"product_type",label:"Type",type:"categorical",options:e.typeOptions},on:{"filter-updated":e.handleFilterUpdated}})],1)]),r("a-button",{attrs:{icon:"filter"}},[e._v("Filter")])],2)},a=[],n=r("7cf1"),i=r("2ef0"),o={name:"OrdersFilters",props:["filters"],components:{InlineFilter:n["a"]},data:function(){return{filtersLocal:null,hasUnsavedChangesFromEvent:!1,unsavedReloadKey:1,typeOptions:[{value:"ERP",label:"ERP"},{value:"print",label:"Print"},{value:"pos",label:"POS"},{value:"apparel",label:"Apparel"},{value:"merchandise",label:"Merchandise"},{value:"packaging",label:"Packaging"}]}},created:function(){this.filtersLocal=i.cloneDeep(this.filters)},computed:{hasUnsavedChanges:function(){var e=!1,t=i.difference(this.filters.filters_enabled,this.filtersLocal.filters_enabled),r=i.difference(this.filtersLocal.filters_enabled,this.filters.filters_enabled);return i.merge(t,r).length&&(e=!0),this.filters["product_type"]!==this.filtersLocal["product_type"]&&(e=!0),e||this.hasUnsavedChangesFromEvent}},methods:{handleFilterUpdated:function(){this.hasUnsavedChangesFromEvent=!0},incrementUnsavedReloadKey:function(){this.unsavedReloadKey+=1},clear:function(){this.filtersLocal.filters_enabled=[]},save:function(){this.$emit("set-filters",i.cloneDeep(this.filtersLocal)),this.$emit("filter-updated"),this.hasUnsavedChangesFromEvent=!1}}},l=o,d=(r("dd13"),r("2877")),c=Object(d["a"])(l,s,a,!1,null,"e7cf4886",null);t["a"]=c.exports},"654e":function(e,t,r){"use strict";r("a54f")},"65b3":function(e,t,r){},"7cf1":function(e,t,r){"use strict";var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"filter-wrapper"},[r("div",{staticClass:"filter-header"},[r("a-checkbox",{attrs:{checked:e.isFilterEnabled},on:{change:e.toggleFilterEnabled}},[e._v(" "+e._s(e.label)+" ")])],1),e.isFilterEnabled?r("div",{staticClass:"filter"},["categorical"===e.type?r("a-select",{staticStyle:{width:"100%"},model:{value:e.details,callback:function(t){e.details=t},expression:"details"}},e._l(e.options,(function(t,s){return r("a-select-option",{key:s,attrs:{value:t.value}},[e._v(" "+e._s(t.label)+" ")])})),1):e._e()],1):e._e()])},a=[],n=(r("caad"),r("2532"),r("2ef0")),i={name:"InlineFilter",props:["filters","id","label","type","options"],data:function(){return{details:null,watchingEnabled:!1}},created:function(){var e=this;this.details=this.filters[this.id],this.$nextTick((function(){e.watchingEnabled=!0}))},computed:{isFilterEnabled:function(){return n.includes(this.filters.filters_enabled,this.id)}},methods:{toggleFilterEnabled:function(){this.filters.filters_enabled=n.xor(this.filters.filters_enabled,[this.id]),this.$emit("filter-updated")}},watch:{details:function(e){this.watchingEnabled&&(this.filters[this.id]=e,this.$emit("filter-updated"))}}},o=i,l=(r("654e"),r("2877")),d=Object(l["a"])(o,s,a,!1,null,"3a2d8a40",null);t["a"]=d.exports},"859f":function(e,t,r){"use strict";r("65b3")},a54f:function(e,t,r){},d4d5:function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"home"},[r("loading-screen",{attrs:{"is-loading":e.isLoading}}),e.order?r("a-page-header",{attrs:{title:e.order.product_name},on:{back:e.backToAllOrders}}):e._e(),e.order?r("div",{staticClass:"page-body"},[r("order-description",{attrs:{order:e.order}})],1):e._e()],1)},a=[],n=r("53ca"),i=r("bc3a"),o=r.n(i),l=r("5aa8"),d=r("2ef0"),c={name:"Show",components:{OrderDescription:l["a"]},data:function(){return{order:null,isLoading:!1,serverErrors:[]}},created:function(){this.loadOrder(this.$route.params.id)},methods:{backToAllOrders:function(){this.$router.push("/orders")},loadOrder:function(e){var t=this;t.order=null,t.isLoading=!0,o.a.get(window.API_BASE+"/orders/"+e).then((function(e){t.isLoading=!1,t.order=e.data})).catch((function(e){var r;t.isLoading=!1,t.$message.error("Error loading order"),console.log(e),r=e.response&&e.response.data&&"object"===Object(n["a"])(e.response.data)?d.flatten(d.toArray(e.response.data.errors)):["Something went wrong. Please try again."],t.serverErrors=r}))}}},u=c,f=(r("859f"),r("2877")),p=Object(f["a"])(u,s,a,!1,null,"d3c5ff78",null);t["default"]=p.exports},dd13:function(e,t,r){"use strict";r("0b90")}}]);
//# sourceMappingURL=orders.6339c1e3.js.map
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["view-project-team"],{"0a40":function(e,t,s){},"19bf":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("a-layout-sider",{style:{background:"#f7fafc",borderRight:"1px solid #e3e8ee"},attrs:{width:"170",theme:"dark","collapsed-width":0,trigger:null}},[s("div",{staticClass:"wrapper"},[s("div",{staticClass:"sidebar-menu"},[s("a",{class:{selected:e.isOverview},attrs:{href:e.overviewHref}},[e._v("Overview")]),s("a",{class:{selected:e.isTeam},attrs:{href:e.teamHref}},[e._v("Team")]),s("a",{class:{selected:e.isChat},attrs:{href:e.chatHref}},[e._v("Chat")]),s("a",{class:{selected:e.isActions},attrs:{href:e.actionsHref}},[e._v("Actions")]),s("a",{class:{selected:e.isOrders},attrs:{href:e.ordersHref}},[e._v("Orders")])]),s("div",{staticClass:"sidebar-footer"})])])},r=[],a=(s("b0c0"),{name:"LeftSidebar",props:["project"],methods:{saveAndExit:function(){this.$router.push("/projects")}},computed:{isScenarios:function(){return"Optimisation Scenarios"===this.$route.name},scenarioHref:function(){return this.optimisation?"/optimisations/"+this.optimisation.id+"/scenarios":"#"},isOverview:function(){return"View Project"===this.$route.name},overviewHref:function(){return this.project?"/projects/"+this.project.id:"#"},isTeam:function(){return"Project Team"===this.$route.name},teamHref:function(){return this.project?"/projects/"+this.project.id+"/team":"#"},isChat:function(){return"Project Chat"===this.$route.name},chatHref:function(){return this.project?"/projects/"+this.project.id+"/chat":"#"},isActions:function(){return"Project Actions"===this.$route.name},actionsHref:function(){return this.project?"/projects/"+this.project.id+"/actions":"#"},isOrders:function(){return"Project Orders"===this.$route.name},ordersHref:function(){return this.project?"/projects/"+this.project.id+"/orders":"#"}}}),o=a,n=(s("d1d9"),s("2877")),c=Object(n["a"])(o,i,r,!1,null,"4241466c",null);t["a"]=c.exports},2589:function(e,t,s){"use strict";s("0a40")},4211:function(e,t,s){"use strict";s("fe9f")},c40c:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"projects"},[s("loading-screen",{attrs:{"is-loading":e.isLoading||e.isLoadingTeam||e.isDeleting||e.isLoadingRoles}}),s("a-layout",[s("left-sidebar",{attrs:{project:e.project}}),s("a-layout",{key:e.updateKey,staticStyle:{padding:"7px 30px"}},[e.project?s("div",{staticClass:"page-header"},[s("h1",{staticClass:"page-title"},[e._v(" "+e._s(e.project.name)+" ")]),s("div",{staticClass:"actions"},[s("add-team-member-button-and-modal",{attrs:{"project-id":e.projectId},on:{reload:e.fetchTeam}})],1)]):e._e(),s("div",[s("a-list",{staticClass:"project-list",attrs:{loading:e.isLoadingTeam,"item-layout":"horizontal","data-source":e.team},scopedSlots:e._u([{key:"renderItem",fn:function(t){return s("team-list-item",{attrs:{roles:e.roles,"project-id":e.projectId,item:t},on:{reload:e.fetchTeam}})}}])}),s("div",{staticClass:"footer-actions"})],1)])],1)],1)},r=[],a=s("5530"),o=s("bc3a"),n=s.n(o),c=s("2f62"),l=s("19bf"),d=s("d9a4"),u=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(t){return t.preventDefault(),e.showModal(t)}}},[e._v(" Add Team Members ")]),s("a-modal",{attrs:{width:700,centered:!0,title:"Add Team Members To Project",footer:null},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[s("loading-screen",{attrs:{"is-loading":e.isSaving}}),1===e.stage?s("div",[s("div",{staticStyle:{"margin-bottom":"20px","text-align":"left"}},[s("a-input-search",{staticStyle:{width:"300px"},attrs:{placeholder:"Search users"},on:{search:e.fetch},model:{value:e.searchQuery,callback:function(t){e.searchQuery=t},expression:"searchQuery"}})],1),s("a-table",{key:e.reloadKey,staticClass:"axpi-table",attrs:{columns:e.columns,"row-selection":e.rowSelection,"row-key":function(e){return e["id"]},"data-source":e.data,pagination:e.pagination,loading:e.loading||e.searchQueryIsDirty||e.isLoadingRoles},on:{change:e.handleTableChange}}),s("div",{staticStyle:{"text-align":"right","margin-top":"15px"}},[s("a-button",{attrs:{disabled:!e.canSave,type:"primary"},on:{click:e.assignPermissions}},[e._v("Next ")])],1)],1):e._e(),2===e.stage?s("div",[e.isLoadingFleshedUsers?s("div",[s("div",{staticClass:"text-center"},[s("a-spin")],1)]):e._e(),e.isLoadingFleshedUsers?e._e():s("div",[e._l(e.selectedUserIds,(function(t,i){return s("div",{key:i,staticClass:"user-permission-block"},[e.getFleshedUser(t)?s("div",[s("b",[e._v(e._s(e.getFleshedUser(t).name))]),s("div",{staticClass:"checkbox-group-wrapper"},[s("a-checkbox-group",{attrs:{options:e.roleOptions},model:{value:e.userRolesMap[t],callback:function(s){e.$set(e.userRolesMap,t,s)},expression:"userRolesMap[userId]"}})],1)]):s("div",[s("b",{staticClass:"text-danger"},[e._v("Can't find fleshed user")])])])})),s("div",{staticStyle:{"text-align":"right","margin-top":"15px"}},[s("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"default"},on:{click:e.goBack}},[e._v(" Back ")]),s("a-button",{attrs:{disabled:!e.canSave,type:"primary"},on:{click:e.save}},[e._v(" Save ")])],1)],2)]):e._e()],1)],1)},h=[],m=(s("7db0"),s("d81d"),s("b0c0"),s("2ef0")),p=[{title:"Name",dataIndex:"name",sorter:!0},{title:"Email",dataIndex:"email",sorter:!0}],f={name:"AddTeamMemberToButtonAndModal",props:["projectId"],data:function(){return{visible:!1,isSaving:!1,serverErrors:[],loading:!1,data:[],pagination:{},searchQuery:"",searchQueryIsDirty:!1,selectedUserIds:[],isLoadingRoles:!1,roles:[],isLoadingFleshedUsers:!1,fleshedUsers:[],userRolesMap:{},columns:p,reloadKey:1,stage:1}},watch:{searchQuery:function(){this.searchQueryIsDirty=!0,this.fetch()}},methods:{showModal:function(){this.visible=!0,this.data=[],this.pagination={},this.searchQueryIsDirty=!1,this.selectedUserIds=[],this.userRolesMap=[],this.stage=1,this.reloadKey+=1,this.loadRoles(),this.fetch()},save:function(){var e=this;e.isSaving=!0,n.a.post(window.API_BASE+"/projects/"+this.projectId+"/team/add-users",{user_ids:this.selectedUserIds,user_roles_map:this.userRolesMap}).then((function(){e.visible=!1,e.isSaving=!1,e.$message.success("Team members added successfully"),e.$emit("reload")})).catch((function(t){console.log(t),e.isSaving=!1,e.$message.error("Error adding team members")}))},determineSearchParams:function(e){return Object(a["a"])({results_per_page:10,q:this.searchQuery},e)},loadRoles:function(){var e=this;e.isLoadingRoles=!0,n.a.get(window.API_BASE+"/project-roles").then((function(t){e.roles=t.data,e.isLoadingRoles=!1})).catch((function(t){console.log(t),e.isLoadingRoles=!1,e.roles=[],e.$message.error("Error loading roles")}))},fetchFleshedUsers:function(){var e=this;e.isLoadingFleshedUsers=!0,e.fleshedUsers=[],n.a.post(window.API_BASE+"/users/get-from-ids",{user_ids:e.selectedUserIds}).then((function(t){e.isLoadingFleshedUsers=!1,e.fleshedUsers=t.data})).catch((function(t){console.log(t),e.isLoadingFleshedUsers=!1}))},getFleshedUser:function(e){return m.find(this.fleshedUsers,{id:e})},fetch:m.debounce((function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=!0,n.a.post(window.API_BASE+"/users/search",this.determineSearchParams(t)).then((function(t){var s=Object(a["a"])({},e.pagination);s.total=t.data.total,e.loading=!1,e.data=t.data.data,e.pagination=s,e.searchQueryIsDirty=!1})).catch((function(t){console.log(t),e.$message.error("Error searching users")}))}),500),handleTableChange:function(e,t,s){var i=Object(a["a"])({},this.pagination);i.current=e.current,this.pagination=i,this.fetch(Object(a["a"])({results_per_page:e.pageSize,page:e.current,sort_field:s.field,sort_order:s.order},t))},assignPermissions:function(){this.canAssignPermissions&&(this.stage+=1),this.fetchFleshedUsers()},goBack:function(){this.stage-=1}},computed:{roleOptions:function(){return m.map(this.roles,(function(e){return{label:e.name,value:e.id}}))},canAssignPermissions:function(){return this.selectedUserIds.length>0},canSave:function(){return this.selectedUserIds.length>0},rowSelection:function(){var e=this;return{onChange:function(t){e.selectedUserIds=t},getCheckboxProps:function(e){return{props:{disabled:"Disabled User"===e.name,name:e.name}}}}}}},g=f,v=(s("4211"),s("2877")),b=Object(v["a"])(g,u,h,!1,null,"031953f6",null),j=b.exports,_=s("4e40"),y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("a-list-item",[e.isEditing?s("div",{attrs:{slot:"actions"},slot:"actions"},[s("loading-screen",{attrs:{"is-loading":e.isSaving}}),s("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:function(t){return t.preventDefault(),e.save(t)}}},[e._v("Save ")]),s("a-button",{attrs:{type:"danger"},on:{click:function(t){return t.preventDefault(),e.cancelEditing(t)}}},[e._v("Cancel ")])],1):e._e(),e.isEditing?e._e():s("a",{attrs:{slot:"actions"},on:{click:function(t){return t.preventDefault(),e.edit(t)}},slot:"actions"},[e._v("Edit")]),e.isEditing?e._e():s("a",{staticClass:"text-danger",attrs:{slot:"actions"},on:{click:function(t){return t.preventDefault(),e.removeTeamMember(e.item)}},slot:"actions"},[e._v("Remove")]),s("a-list-item-meta",[s("div",{attrs:{slot:"description"},slot:"description"},[e.isEditing?e._e():s("div",[e._v(" "+e._s(e.formatTeamMemberProjectRoles(e.item))+" ")]),e.isEditing?s("div",[s("a-checkbox-group",{attrs:{options:e.roleCheckboxOptions},model:{value:e.projectRoleIds,callback:function(t){e.projectRoleIds=t},expression:"projectRoleIds"}})],1):e._e()]),s("a",{attrs:{slot:"title",href:"#"},slot:"title"},[e._v(e._s(e.item.user.name))]),s("a-avatar",{attrs:{slot:"avatar",size:"large",src:e.getAvatar(e.item.user)},slot:"avatar"})],1)],1)},I=[],w=(s("a15b"),s("2ef0")),S={name:"TeamListItem",props:["item","projectId","roles"],mixins:[_["a"]],data:function(){return{isEditing:!1,projectRoleIds:[],isSaving:!1}},computed:{roleCheckboxOptions:function(){return w.map(this.roles,(function(e){return{label:e.name,value:e.id}}))}},methods:{edit:function(){this.isEditing=!0,this.projectRoleIds=w.map(this.item.project_roles,"id")},cancelEditing:function(){this.isEditing=!1},save:function(){var e=this;e.isSaving=!0,n.a.put(window.API_BASE+"/projects/"+this.projectId+"/team/"+this.item.id,{project_role_ids:this.projectRoleIds}).then((function(){e.$message.success("Team member updated successfully"),e.isEditing=!1,e.isSaving=!1,e.$emit("reload")})).catch((function(t){console.log(t),e.isSaving=!1,e.$message.error("Error updating team member")}))},formatTeamMemberProjectRoles:function(e){var t=[];return w.each(e.project_roles,(function(e){t.push(e.name)})),t.length?t.join(", "):"No roles assigned"},removeTeamMember:function(e){var t=this;t.isDeleting=!0,n.a.delete(window.API_BASE+"/projects/"+this.projectId+"/team/"+e.id).then((function(){t.$message.success("Team member removed successfully"),t.isDeleting=!1,t.$emit("reload")})).catch((function(e){console.log(e),t.isDeleting=!1,t.$message.error("Error removing team member")}))}}},E=S,x=Object(v["a"])(E,y,I,!1,null,"6be683bc",null),T=x.exports,k={name:"Team",components:{TeamListItem:T,AddTeamMemberButtonAndModal:j,LeftSidebar:l["a"]},mixins:[d["a"],_["a"]],created:function(){this.projectId=this.$route.params.id,this.loadProject(this.$route.params.id),this.fetchTeam(),this.fetchRoles()},watch:{$route:function(){this.projectId=this.$route.params.id,this.loadProject(this.$route.params.id)}},data:function(){return{projectId:null,updateKey:1,team:[],isLoadingTeam:!1,isDeleting:!1,isLoadingRoles:!1,roles:[]}},computed:Object(a["a"])({},Object(c["c"])("projectEditor",{isLoading:"isLoading",project:"project"})),methods:Object(a["a"])(Object(a["a"])({refresh:function(){this.loadProject(this.$route.params.id)}},Object(c["b"])("projectEditor",{loadProject:"loadProject"})),{},{backToAllProjects:function(){this.$router.push("/projects")},fetchTeam:function(){var e=this;e.isLoadingTeam=!0,e.serverErrors=[],n.a.get(window.API_BASE+"/projects/"+this.projectId+"/team").then((function(t){e.isLoadingTeam=!1,e.team=t.data})).catch((function(t){console.log(t),e.isLoadingTeam=!1,e.setErrors(t),e.$message.error("Error loading team")}))},fetchRoles:function(){var e=this;e.isLoadingRoles=!0,n.a.get(window.API_BASE+"/project-roles").then((function(t){e.roles=t.data,e.isLoadingRoles=!1})).catch((function(t){console.log(t),e.isLoadingRoles=!1,e.roles=[],e.$message.error("Error loading roles")}))}})},$=k,A=(s("2589"),Object(v["a"])($,i,r,!1,null,"591346bb",null));t["default"]=A.exports},d1d9:function(e,t,s){"use strict";s("f9eb")},f9eb:function(e,t,s){},fe9f:function(e,t,s){}}]);
//# sourceMappingURL=view-project-team.50eb8327.js.map
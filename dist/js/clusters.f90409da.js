(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["clusters"],{bf4f:function(e,t,n){"use strict";n("e81a")},e81a:function(e,t,n){},f2f4:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("a-page-header",{attrs:{title:e.pageTitle},on:{back:e.backToIntelligence}},[n("template",{slot:"extra"},[n("create-cluster-button-and-modal")],1)],2),n("loading-screen",{attrs:{"is-loading":e.isDeleting}}),n("clusters-table",{attrs:{"insight-type-filter":e.insightTypeFilter,"reload-key":e.reloadKey},on:{"delete-cluster":e.deleteCluster}})],1)},r=[],s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-table",{staticClass:"axpi-table",attrs:{columns:e.columns,"row-key":function(e){return e.id},"data-source":e.dataToShow,pagination:e.pagination,loading:e.loading},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"name",fn:function(t,a){return n("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.handleRecordSelected(a)}}},[e._v(e._s(t))])}},{key:"numberOfItems",fn:function(t,a){return n("div",{},[e._v(" "+e._s(a["erp_order_ids"]?a["erp_order_ids"].length:"-")+" ")])}},{key:"potentialSavings",fn:function(t,a){return n("div",{},[e._v(" "+e._s(e.formatCost({cost:e.calculatePotentialSavings(a),cost_currency:"USD"}))+" ")])}},{key:"actions",fn:function(t,a){return n("div",{staticClass:"table-actions"},[n("a-dropdown",{attrs:{trigger:["click"]}},[n("a-button",{attrs:{type:"link",icon:"ellipsis"},on:{click:function(e){return e.preventDefault(),function(e){return e.preventDefault()}(e)}}}),n("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[n("a-menu-item",[n("a",{staticClass:"text-danger",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.deleteCluster(a)}}},[e._v("Delete")])])],1)],1)],1)}}])})},i=[],o=(n("4de4"),n("d81d"),n("5530")),c=n("bc3a"),l=n.n(c),u=n("2d20"),d=n("2ef0"),h=[{title:"Name",dataIndex:"name",sorter:!0,scopedSlots:{customRender:"name"}},{title:"Number of Items",scopedSlots:{customRender:"numberOfItems"}},{title:"Potential Savings",dataIndex:"potential_savings",scopedSlots:{customRender:"potentialSavings"}},{title:"",scopedSlots:{customRender:"actions"},width:10}],g={props:["reloadKey","insightTypeFilter"],mixins:[u["a"]],data:function(){return{data:[],pagination:{},loading:!1,columns:h}},mounted:function(){this.fetch()},watch:{reloadKey:function(){this.fetch()}},computed:{dataToShow:function(){var e=this;return this.insightTypeFilter?d.filter(this.data,(function(t){var n=d.filter(t["insights"],{insight_type:e.insightTypeFilter}),a=d.sum(d.map(n,"potential_savings"));return a>0})):this.data}},methods:{handleRecordSelected:function(e){this.$router.push("/intelligence/clusters/"+e["_id"])},handleTableChange:function(e,t,n){var a=Object(o["a"])({},this.pagination);a.current=e.current,this.pagination=a,this.fetch(Object(o["a"])({results_per_page:e.pageSize,page:e.current,sort_field:n.field,sort_order:n.order},t))},fetch:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log("params:",t),this.loading=!0,l.a.post(window.API_BASE+"/intelligence/clusters/search",Object(o["a"])({results_per_page:100},t)).then((function(t){var n=Object(o["a"])({},e.pagination);n.total=t.data.total,e.loading=!1,e.data=t.data.data,e.pagination=n})).catch((function(t){console.log(t),e.$message.error("Error loading clusters")}))},deleteCluster:function(e){this.$emit("delete-cluster",e)},calculatePotentialSavings:function(e){console.log(e);var t=e["insights"],n=d.groupBy(t,"erp_order_id"),a=0;return d.each(n,(function(e){a+=d.max(d.map(e,"potential_savings"))})),a}}},p=g,f=n("2877"),m=Object(f["a"])(p,s,i,!1,null,null,null),v=m.exports,y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(t){return t.preventDefault(),e.showModal(t)}}},[e._v(" New Cluster ")]),n("a-modal",{attrs:{width:850,centered:!0,title:"Create Cluster",footer:null},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("loading-screen",{attrs:{"is-loading":e.isSaving}}),1===e.stage?n("div",[n("a-form",{attrs:{layout:"vertical"}},[n("a-form-item",{attrs:{label:"Name"}},[n("a-input",{attrs:{size:"large"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.goToStageTwo(t)}},model:{value:e.clusterName,callback:function(t){e.clusterName=t},expression:"clusterName"}})],1)],1),n("div",{staticStyle:{"text-align":"right"}},[n("a-button",{attrs:{disabled:!e.canGoToStageTwo,type:"primary"},on:{click:e.goToStageTwo}},[e._v("Next "),n("a-icon",{attrs:{type:"arrow-right"}})],1)],1)],1):e._e(),2===e.stage?n("div",[n("div",{staticStyle:{"margin-bottom":"20px","text-align":"left"}},[n("a-input-search",{staticStyle:{width:"300px"},attrs:{placeholder:"Search orders"},on:{search:e.fetch},model:{value:e.searchQuery,callback:function(t){e.searchQuery=t},expression:"searchQuery"}})],1),n("a-table",{staticClass:"axpi-table",attrs:{columns:e.columns,"row-selection":e.rowSelection,"row-key":function(e){return e["_id"]},"data-source":e.data,pagination:e.pagination,loading:e.loading||e.searchQueryIsDirty},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"cost",fn:function(t){return n("div",{},[e._v(" "+e._s(e.formatCost({cost:t,cost_currency:"USD"}))+" ")])}},{key:"name",fn:function(t,a){return n("div",{},[n("div",{staticClass:"product-name-wrapper"},[n("div",{staticClass:"left"},[n("a-avatar",{staticStyle:{"margin-right":"20px"},attrs:{size:"large",src:a["match_details_images"]}})],1),n("div",{staticClass:"right"},[e._v(" "+e._s(a["match_details_names"][0])+" ")])])])}},{key:"productCode",fn:function(t,a){return n("div",{},[e._v(" "+e._s(a["match_details_product_codes"][0])+" ")])}}],null,!1,2462899454)}),n("div",{staticStyle:{"text-align":"right","margin-top":"15px"}},[n("a-button",{attrs:{disabled:!e.canSave,type:"primary"},on:{click:e.save}},[e._v("Save ")])],1)],1):e._e()],1)],1)},_=[],b=(n("b0c0"),n("2ef0")),S=[{title:"Name",sorter:!0,scopedSlots:{customRender:"name"}},{title:"Cost",dataIndex:"CHF_FLOAT",scopedSlots:{customRender:"cost"},sorter:!0,width:110},{title:"Product Code",dataIndex:"productCode",scopedSlots:{customRender:"productCode"},sorter:!0,width:150}],C={name:"CreateClusterButtonAndModal",mixins:[u["a"]],data:function(){return{visible:!1,clusterName:"",stage:1,isSaving:!1,serverErrors:[],loading:!1,data:[],pagination:{},searchQuery:"",searchQueryIsDirty:!1,selectedOrderIds:[],columns:S}},watch:{searchQuery:function(){this.searchQueryIsDirty=!0,this.fetch()}},methods:{showModal:function(){this.visible=!0,this.clusterName="",this.selectedOrderIds=[],this.stage=1,this.data=[],this.pagination={},this.searchQueryIsDirty=!1,this.selectedOrderIds=[]},goToStageTwo:function(){if(!this.canGoToStageTwo)return!1;this.stage=2,this.fetch()},save:function(){var e=this;e.isSaving=!0,l.a.post(window.API_BASE+"/intelligence/clusters",{name:this.clusterName,erp_order_ids:this.selectedOrderIds}).then((function(t){e.visible=!1,e.isSaving=!1,e.$router.push("/intelligence/clusters/"+t.data["_id"])})).catch((function(t){console.log(t),e.isSaving=!1,e.$message.error("Error creating cluster")}))},determineSearchParams:function(e){return Object(o["a"])({results_per_page:5,q:this.searchQuery},e)},fetch:b.debounce((function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=!0,l.a.post(window.API_BASE+"/intelligence/clusters/search-erp-orders",this.determineSearchParams(t)).then((function(t){var n=Object(o["a"])({},e.pagination);n.total=t.data.total,e.loading=!1,e.data=t.data.data,e.pagination=n,e.searchQueryIsDirty=!1})).catch((function(t){console.log(t),e.$message.error("Error searching ERP orders")}))}),500),handleTableChange:function(e,t,n){var a=Object(o["a"])({},this.pagination);a.current=e.current,this.pagination=a,this.fetch(Object(o["a"])({page:e.current,sortField:n.field,sortOrder:n.order},t))}},computed:{canGoToStageTwo:function(){return this.clusterName.length>0},canSave:function(){return this.selectedOrderIds.length>0},rowSelection:function(){var e=this;return{onChange:function(t){e.selectedOrderIds=t},getCheckboxProps:function(e){return{props:{disabled:"Disabled User"===e.name,name:e.name}}}}}}},w=C,k=(n("bf4f"),Object(f["a"])(w,y,_,!1,null,"8ea4414a",null)),I=k.exports,x={name:"Index",components:{CreateClusterButtonAndModal:I,ClustersTable:v},data:function(){return{isDeleting:!1,reloadKey:1}},computed:{insightTypeFilter:function(){return this.$route.query.insight_type?this.$route.query.insight_type:null},pageTitle:function(){switch(this.insightTypeFilter){case"pricing":return"Clusters With Pricing Outlier Insights";case"demand-aggregation":return"Clusters With Demand Aggregation Insights";case"alternative-product":return"Clusters With Alternative Product Insights";case"contract-negotiation":return"Clusters With Contract Negotiation Insights";case"stockpiling-advised":return"Clusters With Stockpiling Advised Insights";case"expected-demand-increases":return"Clusters With Expected Demand Increases Insights";case"unmatched-orders":return"Clusters With Unmatched Orders Insights";default:return"All Clusters"}}},watch:{$route:function(){this.incrementReloadClustersKey()}},methods:{backToIntelligence:function(){this.$router.push("/intelligence")},incrementReloadClustersKey:function(){this.reloadKey+=1},deleteCluster:function(e){var t=this;t.isDeleting=!0,l.a.delete(window.API_BASE+"/intelligence/clusters/"+e["_id"]).then((function(){t.isDeleting=!1,t.$message.success("Cluster deleted successfully"),t.incrementReloadClustersKey()})).catch((function(e){console.log(e),t.isDeleting=!1,t.$message.success("Error deleting order")}))}}},T=x,O=Object(f["a"])(T,a,r,!1,null,"32804c32",null);t["default"]=O.exports}}]);
//# sourceMappingURL=clusters.f90409da.js.map